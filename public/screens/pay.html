<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>תשלום (דמו)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="/assets/styles.css" />
  <style>
    .payment-container {
      max-width: 500px;
      margin: 0 auto;
      background: var(--bg-card);
      padding: 30px;
      border-radius: 20px;
      box-shadow: var(--shadow);
    }
    .payment-form { display: grid; gap: 16px; }
    .form-group { display: grid; gap: 8px; }
    .form-group label { font-weight: 600; }
    .input, .select, .btn { width: 100%; padding: 10px; border-radius: 10px; border: 1px solid var(--border); background: var(--bg-input); }
    .summary { background: var(--bg-soft); padding: 16px; border-radius: 12px; display: grid; gap: 8px; }
    .summary-row { display: flex; justify-content: space-between; }
    .pay-button { background: var(--accent); color: #fff; border: none; padding: 12px; border-radius: 10px; font-weight: 700; cursor: pointer; }
    .error-message { color: #b00020; margin: 8px 0; display:none; }
    .demo-notice { background: var(--bg-soft); padding: 10px; border-radius: 10px; margin-bottom: 12px; font-size: 0.95rem; }
  </style>
</head>
<body>
  <nav>
    <a href="index.html" id="nav-home" class="nav-item" data-key="nav.home"> בית</a>
    <a href="store.html" id="nav-store" data-key="nav.store">חנות</a>
    <a href="cart.html" id="nav-cart" data-key="nav.cart">סל הקניות</a>
    <a href="checkout.html" id="nav-checkout" data-key="nav.checkout">תשלום</a>
    <a href="myitems.html" id="nav-myitems" data-key="nav.myPurchases">הרכישות שלי</a>
    <a id="login-link" href="login.html" data-key="nav.login">התחברות</a>
    <button id="logout" style="display:none" data-key="nav.logout">התנתקות</button>
    <a href="admin.html" id="nav-admin" data-key="nav.admin" style="display:none">ניהול</a>
    <a href="cake-designer.html" data-key="nav.cakeDesigner">עיצוב עוגה</a>
    <a href="dessert-finder.html" data-key="nav.dessertFinder"> מציאת קינוח מושלם</a>
    <a href="wheel.html" data-key="nav.wheel"> גלגל מזל</a>
    <a href="recipes.html" id="nav-recipes" data-key="nav.recipes"> מתכונים</a>
    <button id="theme-toggle">🌙 מצב כהה</button>
    <button id="language-toggle">🌐 English</button>
  </nav>

  <div class="payment-container">
    <h1 id="page-title">תשלום (דמו)</h1>
    
    <div class="demo-notice" id="demo-notice">
      זהו תשלום דמו לצורכי תרגול בלבד - אין שמירה של פרטי כרטיס
    </div>

    <div id="error-message" class="error-message"></div>

    <div class="coupon-section">
      <div class="form-group">
        <label for="coupon-code" id="coupon-label">קופון הנחה (אופציונלי)</label>
        <div style="display:flex; gap:8px;">
          <input class="input" type="text" id="coupon-code" placeholder="הכנס קוד קופון" />
          <button class="btn" id="apply-coupon-btn">החל</button>
        </div>
      </div>
    </div>

    <div class="summary">
      <div class="summary-row">
        <span id="items-cost-label">עלות הפריטים:</span>
        <span id="items-cost">₪0</span>
      </div>
      <div class="summary-row">
        <span id="shipping-cost-label">עלות משלוח:</span>
        <span id="shipping-cost">₪0</span>
      </div>
      <div class="summary-row" id="discount-row" style="display:none;">
        <span id="discount-text">הנחה:</span>
        <span id="discount-amount">₪0</span>
      </div>
      <div class="summary-row" style="font-weight:700;">
        <span id="total-label">סה"כ לתשלום:</span>
        <span id="total">₪0</span>
      </div>
    </div>

    <form class="payment-form" id="payment-form">
      <div class="form-group">
        <label for="cardNumber" id="card-number-label">מספר כרטיס</label>
        <input class="input" id="cardNumber" type="text" />
      </div>

      <div class="form-group">
        <label for="cardName" id="card-name-label">שם בעל/ת הכרטיס</label>
        <input class="input" id="cardName" type="text" placeholder="שם מלא" />
      </div>

      <div class="form-group">
        <label for="expiry" id="expiry-label">תוקף (MM/YY)</label>
        <input class="input" id="expiry" type="text" />
      </div>

      <div class="form-group">
        <label for="cvv" id="cvv-label">CVV</label>
        <input class="input" id="cvv" type="text" />
      </div>

      <button type="submit" class="pay-button" id="pay-btn">
        שלם עכשיו
      </button>
    </form>
  </div>

  <script>
    // גישה פשוטה מבוססת store.html - בלי מערכות תרגום מורכבות
    const navStore = document.getElementById('nav-store');
    const navCart = document.getElementById('nav-cart');
    const navCheckout = document.getElementById('nav-checkout');
    const navMyitems = document.getElementById('nav-myitems');
    const loginLink = document.getElementById('login-link');
    const logoutBtn = document.getElementById('logout');
    const navAdmin = document.getElementById('nav-admin');
    const pageTitle = document.getElementById('page-title');
    const themeToggle = document.getElementById('theme-toggle');

    function loadUICustomization() {
      const theme = localStorage.getItem('theme') || 'light';
      const themeToggle = document.getElementById('theme-toggle');
      const languageToggle = document.getElementById('language-toggle');
      
      if (theme === 'dark') { 
        document.body.classList.add('dark-theme'); 
        themeToggle.textContent = '☀️ מצב בהיר'; 
      } else { 
        document.body.classList.remove('dark-theme'); 
        themeToggle.textContent = '🌙 מצב כהה'; 
      }
      
      const currentLanguage = localStorage.getItem('language') || 'he';
      languageToggle.textContent = currentLanguage === 'en' ? '🌐 עברית' : '🌐 English';
      updateInterfaceLanguage(currentLanguage);
    }

    function updateInterfaceLanguage(lang) {
      const t = {
        he: {
          'nav-store': 'חנות',
          'nav-cart': 'סל הקניות', 
          'nav-checkout': 'תשלום',
          'nav-myitems': 'הרכישות שלי',
          'login-link': 'התחברות',
          'logout': 'התנתקות',
          'nav-admin': 'ניהול',
          'page-title': 'תשלום (דמו)',
          'demo-notice': 'זהו תשלום דמו לצורכי תרגול בלבד - אין שמירה של פרטי כרטיס',
          'coupon-label': 'קופון הנחה (אופציונלי)',
          'apply-coupon-btn': 'החל',
          'items-cost-label': 'עלות הפריטים:',
          'shipping-cost-label': 'עלות משלוח:',
          'discount-text': 'הנחה:',
          'total-label': 'סה"כ לתשלום:',
          'card-number-label': 'מספר כרטיס',
          'card-name-label': 'שם בעל/ת הכרטיס',
          'expiry-label': 'תוקף (MM/YY)',
          'cvv-label': 'CVV',
          'pay-btn': 'שלם עכשיו',
          'theme-dark': '🌙 מצב כהה',
          'theme-light': '☀️ מצב בהיר',
          'coupon-placeholder': 'הכנס קוד קופון',
          'card-name-placeholder': 'שם מלא'
        },
        en: {
          'nav-store': 'Store',
          'nav-cart': 'Shopping Cart',
          'nav-checkout': 'Checkout',
          'nav-myitems': 'My Purchases',
          'login-link': 'Login',
          'logout': 'Logout',
          'nav-admin': 'Admin',
          'page-title': 'Payment (Demo)',
          'demo-notice': 'This is a demo payment for practice only - no credit card details are saved',
          'coupon-label': 'Discount Coupon (Optional)',
          'apply-coupon-btn': 'Apply',
          'items-cost-label': 'Items Cost:',
          'shipping-cost-label': 'Shipping Cost:',
          'discount-text': 'Discount:',
          'total-label': 'Total to Pay:',
          'card-number-label': 'Card Number',
          'card-name-label': 'Cardholder Name',
          'expiry-label': 'Expiry (MM/YY)',
          'cvv-label': 'CVV',
          'pay-btn': 'Pay Now',
          'theme-dark': '🌙 Dark Mode',
          'theme-light': '☀️ Light Mode',
          'coupon-placeholder': 'Enter coupon code',
          'card-name-placeholder': 'Full name'
        }
      }[lang];
      
      if (!t) return;
      
      navStore.textContent = t['nav-store']; 
      navCart.textContent = t['nav-cart']; 
      navCheckout.textContent = t['nav-checkout'];
      navMyitems.textContent = t['nav-myitems']; 
      loginLink.textContent = t['login-link']; 
      logoutBtn.textContent = t['logout'];
      navAdmin.textContent = t['nav-admin']; 
      pageTitle.textContent = t['page-title'];
      
      document.getElementById('demo-notice').textContent = t['demo-notice'];
      document.getElementById('coupon-label').textContent = t['coupon-label'];
      document.getElementById('apply-coupon-btn').textContent = t['apply-coupon-btn'];
      document.getElementById('items-cost-label').textContent = t['items-cost-label'];
      document.getElementById('shipping-cost-label').textContent = t['shipping-cost-label'];
      document.getElementById('discount-text').textContent = t['discount-text'];
      document.getElementById('total-label').textContent = t['total-label'];
      document.getElementById('card-number-label').textContent = t['card-number-label'];
      document.getElementById('card-name-label').textContent = t['card-name-label'];
      document.getElementById('expiry-label').textContent = t['expiry-label'];
      document.getElementById('cvv-label').textContent = t['cvv-label'];
      document.getElementById('pay-btn').textContent = t['pay-btn'];
      
      document.getElementById('coupon-code').placeholder = t['coupon-placeholder'];
      document.getElementById('cardName').placeholder = t['card-name-placeholder'];
      
      const theme = localStorage.getItem('theme') || 'light';
      themeToggle.textContent = (theme === 'dark') ? t['theme-light'] : t['theme-dark'];
      
      if (lang === 'en') { 
        document.documentElement.dir = 'ltr'; 
        document.documentElement.lang = 'en'; 
      } else { 
        document.documentElement.dir = 'rtl'; 
        document.documentElement.lang = 'he'; 
      }
    }

    document.getElementById('theme-toggle').addEventListener('click', () => {
      const isDark = document.body.classList.contains('dark-theme');
      localStorage.setItem('theme', isDark ? 'light' : 'dark'); 
      loadUICustomization();
    });

    document.getElementById('language-toggle').addEventListener('click', () => {
      const cur = localStorage.getItem('language') || 'he';
      const next = cur === 'he' ? 'en' : 'he';
      localStorage.setItem('language', next);
      
      // עדכון מיידי של כפתור השפה
      const langBtn = document.getElementById('language-toggle');
      langBtn.textContent = next === 'en' ? '🌐 עברית' : '🌐 English';
      
      // עדכון כיוון הדף
      document.documentElement.lang = next;
      document.documentElement.dir = next === 'en' ? 'ltr' : 'rtl';
      
      // בדיקה פשוטה - רק כותרת הדף
      if (next === 'en') {
        document.getElementById('page-title').textContent = 'Payment (Demo)';
        document.getElementById('demo-notice').textContent = 'This is a demo payment for practice only';
      } else {
        document.getElementById('page-title').textContent = 'תשלום (דמו)';
        document.getElementById('demo-notice').textContent = 'זהו תשלום דמו לצורכי תרגול בלבד - אין שמירה של פרטי כרטיס';
      }
    });

    async function setupAuthButtons() {
      let loggedIn = false, username = '';
      try { 
        const r = await fetch('/api/session'); 
        if (r.ok) { 
          loggedIn = true; 
          const data = await r.json(); 
          username = data.username; 
        } 
      } catch {}
      
      loginLink.style.display = loggedIn ? 'none' : '';
      logoutBtn.style.display = loggedIn ? '' : 'none';
      navAdmin.style.display = (loggedIn && username === 'admin') ? '' : 'none';
    }

    document.getElementById('logout').onclick = async () => { 
      try { 
        await fetch('/api/logout', {method:'POST'}); 
      } finally { 
        location.href = '/screens/login.html'; 
      } 
    };

    loadUICustomization();
    setupAuthButtons();
  </script>
</body>
</html>
