<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>עיצוב עוגה מותאמת אישית</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <script src="/assets/translations.js"></script>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
      background: #ffffff; color: #1a1a1a; line-height: 1.6;
    }

    /* Header */
    .header {
      background: #ffffcc; padding: 1rem 2rem; display: flex; justify-content: space-between; align-items: center;
      position: sticky; top: 0; z-index: 1000; box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    }
    .header-left { display: flex; align-items: center; gap: 1rem; }
    .menu-btn { background: none; border: none; font-size: 1.1rem; font-weight: 600; color: #1a1a1a; cursor: pointer; display: flex; align-items: center; gap: .5rem; }
    .menu-btn::before { content: "☰"; font-size: 1.2rem; }
    .logo { font-size: 2.2rem; font-weight: 900; color: #1a1a1a; text-decoration: none; letter-spacing: -0.02em; }
    .header-nav { display: flex; align-items: center; gap: 1rem; }
    .header-btn {
      background: none; border: 2px solid #1a1a1a; color: #1a1a1a; padding: .5rem 1rem; border-radius: 20px;
      font-weight: 600; font-size: .9rem; cursor: pointer; transition: all .2s ease; text-decoration: none;
      display: flex; align-items: center; gap: .3rem;
    }
    .header-btn:hover { background: #1a1a1a; color: white; }
    .header-btn.primary { background: #1a1a1a; color: white; }
    .header-btn.primary:hover { background: #333; }

    /* רק התחברות עם אייקון; בית/חנות/סל – טקסט בלבד */
    .login-btn::before { content: "👤"; }

    /* Navigation Menu */
    .nav-menu {
      position: fixed; top: 0; right: -300px; width: 300px; height: 100vh; background: white;
      box-shadow: -5px 0 15px rgba(0, 0, 0, 0.1); transition: right .3s ease; padding: 2rem; z-index: 2000;
    }
    .nav-menu.active { right: 0; }
    .nav-close { background: none; border: none; font-size: 1.5rem; cursor: pointer; float: left; margin-bottom: 2rem; }
    .nav-item, .nav-menu a, .nav-menu button {
      display: block; padding: .75rem 0; color: #1a1a1a; text-decoration: none; font-weight: 500;
      border-bottom: 1px solid #f0f0f0; transition: color .2s ease; background: none; border: none; text-align: right; width: 100%; cursor: pointer;
    }
    .nav-item:hover, .nav-menu a:hover, .nav-menu button:hover { color: #ffffcc; }

    /* Overlay */
    .overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1500; opacity: 0; visibility: hidden; transition: all .3s ease; }
    .overlay.active { opacity: 1; visibility: visible; }

    /* Main Content */
    .main-content { max-width: 1200px; margin: 0 auto; padding: 2rem; }
    .page-header { text-align: center; margin-bottom: 2rem; }
    #main-title { font-size: 3rem; font-weight: 900; color: #1a1a1a; margin-bottom: 1rem; letter-spacing: -0.02em; text-transform: uppercase; }
    #subtitle { color: #666; font-size: 1.1rem; margin-bottom: 2rem; }

    /* Designer Container */
    .designer-container { display: grid; grid-template-columns: 1fr 400px; gap: 2rem; margin-top: 2rem; }
    .cake-preview {
      background: white; border-radius: 15px; padding: 2rem; display: flex; flex-direction: column; align-items: center; justify-content: center;
      min-height: 600px; box-shadow: 0 5px 20px rgba(0,0,0,0.08); position: relative;
    }
    .cake-display { position: relative; transition: all .5s ease; width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; }
    .cake-image { width: 100%; height: 100%; min-height: 500px; object-fit: cover; border-radius: 15px; box-shadow: 0 15px 40px rgba(0,0,0,0.12); transition: all .3s ease; background: #f8f8f8; }
    .cake-image.bento { min-height: 450px; }
    .cake-image.large { min-height: 550px; }

    .char-counter { text-align: left; font-size: 12px; color: #666; margin-top: 5px; }
    .cake-text-overlay {
      position: absolute; top: 30%; left: 50%; transform: translate(-50%, -50%); padding: 0; border-radius: 0;
      font-weight: bold; font-size: 24px; color: #333; text-align: center; background: none; border: none; backdrop-filter: none; box-shadow: none; max-width: 80%;
      word-wrap: break-word; transition: color .3s ease;
    }
    .cake-text-overlay.bento { font-size: 24px; top: 28%; }
    .cake-text-overlay.large { font-size: 24px; top: 28%; }
    .cake-text-overlay.empty { display: none; }

    .design-panel { background: white; border-radius: 15px; padding: 2rem; box-shadow: 0 5px 20px rgba(0,0,0,0.08); max-height: 700px; overflow-y: auto; }
    .design-section { margin-bottom: 2rem; padding-bottom: 1.5rem; border-bottom: 1px solid #f0f0f0; }
    .design-section:last-child { border-bottom: none; }
    .section-title { font-size: 1.2rem; font-weight: 700; color: #1a1a1a; margin-bottom: 1rem; display: flex; align-items: center; gap: .5rem; }

    .size-options { display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; }
    .size-option {
      padding: 1rem; border: 2px solid #f0f0f0; border-radius: 15px; text-align: center; cursor: pointer; transition: all .3s ease; background: white;
    }
    .size-option:hover { border-color: #1a1a1a; transform: translateY(-2px); box-shadow: 0 5px 20px rgba(0,0,0,0.08); }
    .size-option.selected { border-color: #1a1a1a; background: #1a1a1a; color: white; }
    .size-title { font-weight: bold; margin-bottom: .5rem; }
    .size-subtitle { font-size: .9rem; opacity: .8; }

    .color-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 1rem; margin-top: 1rem; }
    .color-option {
      aspect-ratio: 1; border-radius: 15px; cursor: pointer; border: 3px solid transparent; transition: all .3s ease; position: relative;
      box-shadow: 0 5px 20px rgba(0,0,0,0.08); overflow: hidden; background-size: cover; background-position: center; background-repeat: no-repeat;
    }
    .color-option:hover { transform: scale(1.05); box-shadow: 0 15px 40px rgba(0,0,0,0.12); }
    .color-option.selected { border-color: #1a1a1a; transform: scale(1.1); box-shadow: 0 15px 40px rgba(0,0,0,0.12); }
    .color-option::after {
      content: attr(data-name); position: absolute; bottom: -30px; left: 50%; transform: translateX(-50%); font-size: .8rem; font-weight: 600; white-space: nowrap; opacity: 0;
      transition: opacity .3s ease; background: #333; color: white; padding: .3rem .6rem; border-radius: 6px; pointer-events: none;
    }
    .color-option:hover::after { opacity: 1; }

    .text-input {
      width: 100%; padding: 1rem 1.5rem; border: 2px solid #f0f0f0; border-radius: 15px; font-size: 1rem; transition: all .2s ease; font-family: inherit; background: white;
    }
    .text-input:focus { outline: none; border-color: #1a1a1a; box-shadow: 0 0 0 3px rgba(26,26,26,.1); }

    .text-color-grid { display: grid; grid-template-columns: repeat(6, 1fr); gap: .8rem; margin-top: 1rem; }
    .text-color-option { aspect-ratio: 1; border-radius: 50%; cursor: pointer; border: 3px solid transparent; transition: all .3s ease; position: relative; box-shadow: 0 5px 20px rgba(0,0,0,0.08); }
    .text-color-option:hover { transform: scale(1.1); box-shadow: 0 15px 40px rgba(0,0,0,0.12); }
    .text-color-option.selected { border-color: #1a1a1a; transform: scale(1.15); box-shadow: 0 15px 40px rgba(0,0,0,0.12); }
    .text-color-option::after {
      content: attr(data-name); position: absolute; bottom: -30px; left: 50%; transform: translateX(-50%); font-size: .7rem; font-weight: 600; white-space: nowrap; opacity: 0;
      transition: opacity .3s ease; background: #333; color: white; padding: .3rem .6rem; border-radius: 6px; pointer-events: none; z-index: 100;
    }
    .text-color-option:hover::after { opacity: 1; }

    .price-summary { background: #1a1a1a; color: white; padding: 1.5rem; border-radius: 15px; text-align: center; margin-top: 1.5rem; }
    .total-price { font-size: 2rem; font-weight: bold; margin-bottom: .5rem; }
    .add-to-cart-btn {
      background: white; color: #1a1a1a; border: none; padding: 1rem 2rem; border-radius: 15px; font-weight: bold; font-size: 1rem; cursor: pointer; transition: all .3s ease;
      width: 100%; margin-top: 1rem;
    }
    .add-to-cart-btn:hover { transform: translateY(-2px); box-shadow: 0 5px 20px rgba(255,255,255,.3); }
    .add-to-cart-btn:disabled { opacity: .6; cursor: not-allowed; }

    /* Toast */
    #toast {
      position: fixed; top: 12px; right: 12px; z-index: 9999; display: none; padding: 10px 14px; background: #333; color: #fff; border-radius: 10px;
      box-shadow: 0 4px 12px rgba(0,0,0,.2); font-size: 14px; opacity: 0; transform: translateY(-6px); transition: opacity .2s, transform .2s;
    }
    #toast.show { display: block; opacity: 1; transform: translateY(0); }

    /* Dark Theme */
    .dark-theme { background: #1a1a1a; color: white; }
    .dark-theme .header { background: #2d2d2d; }
    .dark-theme .nav-menu { background: #2d2d2d; }
    .dark-theme .nav-menu a, .dark-theme .nav-menu button { color: white; border-bottom-color: #444; }
    .dark-theme .cake-preview, .dark-theme .design-panel { background: #2d2d2d; }
    .dark-theme .section-title, .dark-theme #main-title { color: white; }
    .dark-theme .text-input { background: #3d3d3d; border-color: #555; color: white; }
    .dark-theme .text-input:focus { border-color: #ffffcc; }
    .dark-theme .size-option { background: #3d3d3d; border-color: #555; color: white; }
    .dark-theme .size-option:hover { border-color: #ffffcc; }
    .dark-theme .size-option.selected { background: #ffffcc; border-color: #ffffcc; color: #1a1a1a; }
    .dark-theme .price-summary { background: #ffffcc; color: #1a1a1a; }
    .dark-theme .add-to-cart-btn { background: #1a1a1a; color: white; }

    /* Animation */
    @keyframes cakeSwitch { 0%{opacity:1;transform:scale(1)} 50%{opacity:.7;transform:scale(.95)} 100%{opacity:1;transform:scale(1)} }
    .cake-switching { animation: cakeSwitch .5s ease-in-out; }

    .sparkle { position: absolute; width: 6px; height: 6px; background: #ffd700; border-radius: 50%; animation: sparkle 2s infinite; pointer-events: none; }
    @keyframes sparkle { 0%,100%{opacity:0;transform:scale(0) rotate(0)} 50%{opacity:1;transform:scale(1) rotate(180deg)} }

    /* Responsive */
    @media (max-width: 1024px) {
      .designer-container { grid-template-columns: 1fr; gap: 1.5rem; }
      .cake-preview { order: -1; min-height: 400px; padding: 1rem; }
      .cake-image { min-height: 350px; }
    }
    @media (max-width: 768px) {
      .header { padding: 1rem; flex-wrap: wrap; gap: 1rem; }
      .header-left { order: 1; }
      .logo { font-size: 1.8rem; order: 2; }
      .header-nav { order: 3; width: 100%; justify-content: center; gap: .5rem; }
      .header-btn { padding: .4rem .6rem; font-size: .75rem; }
      .main-content { padding: 1rem; }
      #main-title { font-size: 2rem; }
      .color-grid { grid-template-columns: repeat(3, 1fr); }
      .text-color-grid { grid-template-columns: repeat(4, 1fr); }
    }
    @media (max-width: 480px) {
      .header-btn { padding: .3rem .5rem; font-size: .7rem; }
      .header-btn::before { display: none; }
      .size-options { grid-template-columns: 1fr; }
      .color-grid { grid-template-columns: repeat(2, 1fr); }
      .text-color-grid { grid-template-columns: repeat(3, 1fr); }
    }
  </style>
</head>
<body>
  <div class="overlay" id="overlay"></div>
  
  <header class="header">
    <div class="header-left">
      <button class="menu-btn" id="menuBtn">Menu</button>
      <a href="/" class="logo">dessert</a>
    </div>
    
    <nav class="header-nav">
      <a href="index.html" class="header-btn home-btn">בית</a>
      <a href="store.html" class="header-btn">חנות</a>
      <a href="cart.html" class="header-btn cart-btn">סל קניות</a>
      <a href="login.html" class="header-btn login-btn" id="header-login">התחברות</a>
    </nav>
  </header>

  <nav class="nav-menu" id="navMenu">
    <button class="nav-close" id="navClose">×</button>

    <a href="store.html" id="nav-store">חנות</a>
    <a href="cart.html" id="nav-cart">סל הקניות</a>
    <a href="checkout.html" id="nav-checkout">תשלום</a>
    <a href="myitems.html" id="nav-myitems">הרכישות שלי</a>
    <a href="admin.html" id="nav-admin" style="display:none">ניהול</a>
    <a href="dessert-finder.html">מציאת הקינוח המושלם</a>
    <a href="wheel.html">גלגל מזל</a>
    <a href="cake-designer.html">עיצוב עוגה</a>
    <a href="recipes.html" id="nav-recipes">מתכונים</a>
    <button id="logout" style="display:none">התנתקות</button>
    <button id="theme-toggle">🌙 מצב כהה</button>
    <button id="language-toggle">🌍 English</button>
  </nav>


  <div id="toast"></div>

  <main class="main-content">
    <div class="page-header">
      <h1 id="main-title">🎨 <span id="title-text">עיצוב עוגה מותאמת אישית</span></h1>
      <p id="subtitle">עצב את העוגה המושלמת עבורך</p>
    </div>

    <div class="designer-container">
      <div class="cake-preview">
        <div class="cake-display" id="cakeDisplay">
          <img id="cakeImage" class="cake-image" src="/images/cakes/cake-pink.png" alt="עוגה מותאמת" />
          <div class="cake-text-overlay empty" id="cakeTextOverlay"></div>
        </div>
      </div>

      <div class="design-panel">
        <!-- בחירת גודל -->
        <div class="design-section">
          <div class="section-title" id="size-section-title">🔍 בחירת גודל העוגה</div>
          <div class="size-options">
            <div class="size-option selected" data-size="bento">
              <div class="size-title" id="bento-title">בנטו</div>
              <div class="size-subtitle" id="bento-size">קוטר 10 ס"מ</div>
              <div class="size-subtitle">₪140</div>
            </div>
            <div class="size-option" data-size="large">
              <div class="size-title" id="large-title">גדולה</div>
              <div class="size-subtitle" id="large-size">קוטר 22 ס"מ</div>
              <div class="size-subtitle">₪300</div>
            </div>
          </div>
        </div>

        <!-- בחירת צבע עוגה -->
        <div class="design-section">
          <div class="section-title" id="color-section-title">🎨 בחירת צבע העוגה</div>
          <div class="color-grid">
            <div class="color-option selected" data-color="pink" data-name="ורוד" style="background-image:url('/images/cakes/cake-pink.png')"></div>
            <div class="color-option" data-color="white" data-name="לבן" style="background-image:url('/images/cakes/cake-white.png')"></div>
            <div class="color-option" data-color="green" data-name="ירוק" style="background-image:url('/images/cakes/cake-green.png')"></div>
            <div class="color-option" data-color="red" data-name="אדום" style="background-image:url('/images/cakes/cake-red.png')"></div>
            <div class="color-option" data-color="purple" data-name="סגול" style="background-image:url('/images/cakes/cake-purple.png')"></div>
            <div class="color-option" data-color="light-blue" data-name="כחול בהיר" style="background-image:url('/images/cakes/cake-light-blue.png')"></div>
            <div class="color-option" data-color="orange" data-name="כתום" style="background-image:url('/images/cakes/cake-orange.png')"></div>
          </div>
        </div>

        <!-- הוספת כיתוב -->
        <div class="design-section">
          <div class="section-title" id="text-section-title">✏️ כיתוב על העוגה</div>
          <input type="text" class="text-input" id="cakeTextInput" placeholder="הכנס כיתוב (עד 20 תווים)" maxlength="20" value="" />
          <div class="char-counter"><span id="charCount">0</span><span id="char-limit">/20 תווים</span></div>
        </div>

        <!-- בחירת צבע כיתוב -->
        <div class="design-section">
          <div class="section-title" id="text-color-section-title">🌈 צבע הכיתוב</div>
          <div class="text-color-grid">
            <div class="text-color-option selected" data-text-color="#333333" data-name="שחור" style="background:#333333;"></div>
            <div class="text-color-option" data-text-color="#ffffff" data-name="לבן" style="background:#ffffff; border:2px solid #ddd;"></div>
            <div class="text-color-option" data-text-color="#ff1744" data-name="אדום" style="background:#ff1744;"></div>
            <div class="text-color-option" data-text-color="#e91e63" data-name="ורוד" style="background:#e91e63;"></div>
            <div class="text-color-option" data-text-color="#9c27b0" data-name="סגול" style="background:#9c27b0;"></div>
            <div class="text-color-option" data-text-color="#3f51b5" data-name="כחול" style="background:#3f51b5;"></div>
            <div class="text-color-option" data-text-color="#00bcd4" data-name="טורקיז" style="background:#00bcd4;"></div>
            <div class="text-color-option" data-text-color="#4caf50" data-name="ירוק" style="background:#4caf50;"></div>
            <div class="text-color-option" data-text-color="#ff9800" data-name="כתום" style="background:#ff9800;"></div>
            <div class="text-color-option" data-text-color="#ffc107" data-name="צהוב" style="background:#ffc107;"></div>
            <div class="text-color-option" data-text-color="#795548" data-name="חום" style="background:#795548;"></div>
            <div class="text-color-option" data-text-color="#607d8b" data-name="אפור" style="background:#607d8b;"></div>
          </div>
        </div>

        <!-- סיכום מחיר -->
        <div class="price-summary">
          <div class="total-price" id="totalPrice">₪140</div>
          <div id="custom-cake-text">עוגה מותאמת אישית</div>
          <button class="add-to-cart-btn" id="addToCartBtn">🛒 הוסף לסל הקניות</button>
        </div>
      </div>
    </div>
  </main>

  <script>
    // Menu functionality
    const menuBtn = document.getElementById('menuBtn');
    const navMenu = document.getElementById('navMenu');
    const navClose = document.getElementById('navClose');
    const overlay = document.getElementById('overlay');
    function openMenu(){ navMenu.classList.add('active'); overlay.classList.add('active'); document.body.style.overflow='hidden'; }
    function closeMenu(){ navMenu.classList.remove('active'); overlay.classList.remove('active'); document.body.style.overflow='auto'; }
    menuBtn.addEventListener('click', openMenu);
    navClose.addEventListener('click', closeMenu);
    overlay.addEventListener('click', closeMenu);

    // Translation system
    const TRANSLATIONS = {
      he: {
        'title-text': 'עיצוב עוגה מותאמת אישית',
        'subtitle': 'עצב את העוגה המושלמת עבורך',
        'size-section-title': '🔍 בחירת גודל העוגה',
        'bento-title': 'בנטו',
        'bento-size': 'קוטר 10 ס"מ',
        'large-title': 'גדולה',
        'large-size': 'קוטר 22 ס"מ',
        'color-section-title': '🎨 בחירת צבע העוגה',
        'text-section-title': '✏️ כיתוב על העוגה',
        'text-input-placeholder': 'הכנס כיתוב (עד 20 תווים)',
        'char-limit': '/20 תווים',
        'text-color-section-title': '🌈 צבע הכיתוב',
        'custom-cake-text': 'עוגה מותאמת אישית',
        'add-to-cart-btn': '🛒 הוסף לסל הקניות',
        'nav-checkout': 'תשלום',
        'nav-myitems': 'הרכישות שלי',
        'nav-admin': 'ניהול',
        'nav-recipes': 'מתכונים',
        'nav-store': 'חנות',
        'logout': 'התנתקות',
        'theme-toggle-dark': '🌙 מצב כהה',
        'theme-toggle-light': '☀️ מצב בהיר',
        'colors': {
          'pink': 'ורוד',
          'white': 'לבן',
          'green': 'ירוק',
          'red': 'אדום',
          'purple': 'סגול',
          'light-blue': 'כחול בהיר',
          'orange': 'כתום'
        },
        'text-colors': {
          'black': 'שחור',
          'white': 'לבן',
          'red': 'אדום',
          'pink': 'ורוד',
          'purple': 'סגול',
          'blue': 'כחול',
          'turquoise': 'טורקיז',
          'green': 'ירוק',
          'orange': 'כתום',
          'yellow': 'צהוב',
          'brown': 'חום',
          'gray': 'אפור'
        }
      },
      en: {
        'title-text': 'Custom Cake Designer',
        'subtitle': 'Design the perfect cake for you',
        'size-section-title': '🔍 Cake Size Selection',
        'bento-title': 'Bento',
        'bento-size': 'Diameter 10cm',
        'large-title': 'Large',
        'large-size': 'Diameter 22cm',
        'color-section-title': '🎨 Cake Color Selection',
        'text-section-title': '✏️ Text on Cake',
        'text-input-placeholder': 'Enter text (up to 20 characters)',
        'char-limit': '/20 characters',
        'text-color-section-title': '🌈 Text Color',
        'custom-cake-text': 'Custom Cake',
        'add-to-cart-btn': '🛒 Add to Cart',
        'nav-checkout': 'Checkout',
        'nav-myitems': 'My Purchases',
        'nav-admin': 'Admin',
        'nav-recipes': 'Recipes',
        'nav-store': 'Store',
        'logout': 'Logout',
        'theme-toggle-dark': '🌙 Dark Mode',
        'theme-toggle-light': '☀️ Light Mode',
        'colors': {
          'pink': 'Pink',
          'white': 'White',
          'green': 'Green',
          'red': 'Red',
          'purple': 'Purple',
          'light-blue': 'Light Blue',
          'orange': 'Orange'
        },
        'text-colors': {
          'black': 'Black',
          'white': 'White',
          'red': 'Red',
          'pink': 'Pink',
          'purple': 'Purple',
          'blue': 'Blue',
          'turquoise': 'Turquoise',
          'green': 'Green',
          'orange': 'Orange',
          'yellow': 'Yellow',
          'brown': 'Brown',
          'gray': 'Gray'
        }
      }
    };

    // UI customization
    function loadUICustomization() {
      const theme = localStorage.getItem('theme') || 'light';
      const lang = localStorage.getItem('language') || 'he';
      
      // Apply theme
      const themeToggle = document.getElementById('theme-toggle');
      if (theme === 'dark') {
        document.body.classList.add('dark-theme');
        themeToggle.textContent = TRANSLATIONS[lang]['theme-toggle-light'];
      } else {
        document.body.classList.remove('dark-theme');
        themeToggle.textContent = TRANSLATIONS[lang]['theme-toggle-dark'];
      }
      
      // Apply language but DON'T change direction - keep RTL always
      document.documentElement.lang = lang;
      // Always keep RTL direction regardless of language
      document.documentElement.dir = 'rtl';
      
      // Update language toggle button
      const languageToggle = document.getElementById('language-toggle');
      languageToggle.textContent = lang === 'en' ? '🌐 עברית' : '🌐 English';
      
      // Update all text content
      updateAllTexts(lang);
    }

    function updateAllTexts(lang) {
      const texts = TRANSLATIONS[lang];
      
      // Update main text elements
      Object.keys(texts).forEach(key => {
        if (typeof texts[key] === 'string') {
          const element = document.getElementById(key);
          if (element) {
            if (element.tagName === 'INPUT') {
              element.placeholder = texts[key];
            } else {
              element.textContent = texts[key];
            }
          }
        }
      });
      
      // Update navigation
      const navElements = ['nav-checkout', 'nav-myitems', 'nav-admin', 'nav-recipes', 'nav-store', 'logout'];
      navElements.forEach(id => {
        const element = document.getElementById(id);
        if (element && texts[id]) {
          element.textContent = texts[id];
        }
      });
      
      // Update header navigation
      const headerBtns = document.querySelectorAll('.header-btn');
      if (lang === 'en') {
        headerBtns[0].textContent = 'Home';
        headerBtns[1].textContent = 'Store';
        headerBtns[2].textContent = 'Cart';
        if (headerBtns[3]) headerBtns[3].textContent = 'Login';
      } else {
        headerBtns[0].textContent = 'בית';
        headerBtns[1].textContent = 'חנות';
        headerBtns[2].textContent = 'סל קניות';
        if (headerBtns[3]) headerBtns[3].textContent = 'התחברות';
      }
      
      // Update color names
      updateColorNames(lang);
      
      // Update text input placeholder
      const textInput = document.getElementById('cakeTextInput');
      if (textInput) {
        textInput.placeholder = texts['text-input-placeholder'];
      }
    }

    function updateColorNames(lang) {
      const colorOptions = document.querySelectorAll('.color-option');
      const textColorOptions = document.querySelectorAll('.text-color-option');
      
      const colorTranslations = TRANSLATIONS[lang]['colors'];
      const textColorTranslations = TRANSLATIONS[lang]['text-colors'];
      
      colorOptions.forEach(option => {
        const color = option.getAttribute('data-color');
        if (colorTranslations[color]) {
          option.setAttribute('data-name', colorTranslations[color]);
        }
      });
      
      textColorOptions.forEach(option => {
        const colorName = option.getAttribute('data-name');
        const englishName = Object.keys(TRANSLATIONS.en['text-colors']).find(
          key => TRANSLATIONS.en['text-colors'][key] === colorName || 
                 TRANSLATIONS.he['text-colors'][key] === colorName
        );
        if (englishName && textColorTranslations[englishName]) {
          option.setAttribute('data-name', textColorTranslations[englishName]);
        }
      });
    }

    document.getElementById('theme-toggle').addEventListener('click', () => {
      const isDark = document.body.classList.contains('dark-theme');
      localStorage.setItem('theme', isDark ? 'light' : 'dark');
      loadUICustomization();
    });

    document.getElementById('language-toggle').addEventListener('click', () => {
      const current = localStorage.getItem('language') || 'he';
      const next = current === 'he' ? 'en' : 'he';
      localStorage.setItem('language', next);
      loadUICustomization();
    });

    // Current design
    let currentDesign = { size: 'bento', color: 'pink', text: '', textColor: '#333333' };
    const prices = { bento: 140, large: 300 };
    const colorFiles = { 
      pink: 'cake-pink.png', 
      white: 'cake-white.png', 
      green: 'cake-green.png', 
      red: 'cake-red.png', 
      purple: 'cake-purple.png', 
      'light-blue': 'cake-light-blue.png', 
      orange: 'cake-orange.png' 
    };

    const cakeImage = document.getElementById('cakeImage');
    const cakeTextOverlay = document.getElementById('cakeTextOverlay');
    const cakeTextInput = document.getElementById('cakeTextInput');
    const charCount = document.getElementById('charCount');
    const totalPrice = document.getElementById('totalPrice');

    function updateCakePreview() {
      cakeImage.className = `cake-image ${currentDesign.size}`;
      cakeTextOverlay.className = `cake-text-overlay ${currentDesign.size}`;
      const newSrc = `/images/cakes/${colorFiles[currentDesign.color]}`;
      if (cakeImage.src !== location.origin + newSrc) {
        cakeImage.classList.add('cake-switching');
        setTimeout(() => {
          cakeImage.src = newSrc;
          cakeImage.classList.remove('cake-switching');
        }, 250);
      }
      if (currentDesign.text.trim()) {
        cakeTextOverlay.textContent = currentDesign.text;
        cakeTextOverlay.classList.remove('empty');
      } else {
        cakeTextOverlay.classList.add('empty');
      }
      cakeTextOverlay.style.color = currentDesign.textColor;
      totalPrice.textContent = `₪${prices[currentDesign.size]}`;
    }

    document.querySelectorAll('.size-option').forEach(option => {
      option.addEventListener('click', () => {
        document.querySelectorAll('.size-option').forEach(o => o.classList.remove('selected'));
        option.classList.add('selected');
        currentDesign.size = option.dataset.size;
        updateCakePreview();
        addSparkles();
      });
    });

    document.querySelectorAll('.color-option').forEach(opt => {
      opt.addEventListener('click', () => {
        document.querySelectorAll('.color-option').forEach(o => o.classList.remove('selected'));
        opt.classList.add('selected');
        currentDesign.color = opt.dataset.color;
        updateCakePreview();
        addSparkles();
      });
    });

    document.querySelectorAll('.text-color-option').forEach(opt => {
      opt.addEventListener('click', () => {
        document.querySelectorAll('.text-color-option').forEach(o => o.classList.remove('selected'));
        opt.classList.add('selected');
        currentDesign.textColor = opt.dataset.textColor;
        updateCakePreview();
        addSparkles();
      });
    });

    cakeTextInput.addEventListener('input', e => {
      const t = e.target.value;
      currentDesign.text = t;
      charCount.textContent = t.length;
      updateCakePreview();
    });

    const toastEl = document.getElementById('toast');
    let toastTimer;
    function showToast(msg) {
      toastEl.textContent = msg;
      toastEl.classList.add('show');
      clearTimeout(toastTimer);
      toastTimer = setTimeout(() => toastEl.classList.remove('show'), 1500);
    }

    document.getElementById('addToCartBtn').addEventListener('click', async () => {
      const button = document.getElementById('addToCartBtn');
      button.disabled = true;
      const designDetails = {
        size: currentDesign.size,
        color: currentDesign.color,
        text: currentDesign.text,
        textColor: currentDesign.textColor,
        price: prices[currentDesign.size],
        imageFile: colorFiles[currentDesign.color]
      };
      try {
        const response = await fetch('/api/cart', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ productId: 'custom-cake', customDesign: designDetails })
        });
        if (response.status === 401) {
          location.href = 'login.html';
          return;
        }
        if (response.ok) {
          const originalText = button.textContent;
          const lang = localStorage.getItem('language') || 'he';
          button.textContent = lang === 'en' ? '✅ Added to Cart!' : '✅ נוסף לסל!';
          button.style.background = '#28a745';
          for (let i = 0; i < 5; i++) setTimeout(() => addSparkles(), i * 300);
          setTimeout(() => {
            button.textContent = originalText;
            button.style.background = '';
            button.disabled = false;
          }, 3000);
        } else {
          const error = await response.json();
          const lang = localStorage.getItem('language') || 'he';
          alert(error.error || (lang === 'en' ? 'Error adding to cart' : 'שגיאה בהוספה לסל'));
          button.disabled = false;
        }
      } catch (err) {
        console.error('Error adding to cart:', err);
        const lang = localStorage.getItem('language') || 'he';
        alert(lang === 'en' ? 'Error adding to cart. Please try again.' : 'שגיאה בהוספה לסל. נסה שוב.');
        button.disabled = false;
      }
    });

    function addSparkles() {
      const preview = document.querySelector('.cake-preview');
      for (let i = 0; i < 8; i++) {
        setTimeout(() => {
          const s = document.createElement('div');
          s.className = 'sparkle';
          s.style.left = (20 + Math.random() * 60) + '%';
          s.style.top = (20 + Math.random() * 60) + '%';
          preview.appendChild(s);
          setTimeout(() => s.remove(), 2000);
        }, i * 100);
      }
    }

    async function setupAuth() {
      try {
        const r = await fetch('/api/session');
        if (r.ok) {
          const data = await r.json();
          document.getElementById('header-login').style.display = 'none';
          document.getElementById('logout').style.display = '';
          if (data.username === 'admin') document.getElementById('nav-admin').style.display = '';
        }
      } catch {}
    }

    document.getElementById('logout').onclick = async () => {
      try {
        await fetch('/api/logout', { method: 'POST' });
      } finally {
        location.href = 'login.html';
      }
    };

    document.addEventListener('DOMContentLoaded', () => {
      setTimeout(() => {
        loadUICustomization();
        setupAuth();
        updateCakePreview();
        setTimeout(addSparkles, 1000);
      }, 100);
    });
  </script>
</body>
</html>