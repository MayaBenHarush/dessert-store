<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>◊û◊¶◊ô◊ê◊™ ◊î◊ß◊ô◊†◊ï◊ó ◊î◊û◊ï◊©◊ú◊ù</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
      background: #ffffff;
      color: #1a1a1a;
      line-height: 1.6;
    }

    /* Header */
    .header {
      background: #ffffcc;
      padding: 1rem 2rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
      position: sticky;
      top: 0;
      z-index: 1000;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    }

    .header-left {
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    .menu-btn {
      background: none;
      border: none;
      font-size: 1.1rem;
      font-weight: 600;
      color: #1a1a1a;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .menu-btn::before {
      content: "‚ò∞";
      font-size: 1.2rem;
    }

    .logo {
      font-size: 2.2rem;
      font-weight: 900;
      color: #1a1a1a;
      text-decoration: none;
      letter-spacing: -0.02em;
    }

    .header-nav {
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    .header-btn {
      background: none;
      border: 2px solid #1a1a1a;
      color: #1a1a1a;
      padding: 0.5rem 1rem;
      border-radius: 20px;
      font-weight: 600;
      font-size: 0.9rem;
      cursor: pointer;
      transition: all 0.2s ease;
      text-decoration: none;
      display: flex;
      align-items: center;
      gap: 0.3rem;
    }

    .header-btn:hover {
      background: #1a1a1a;
      color: white;
    }

    .header-btn.primary {
      background: #1a1a1a;
      color: white;
    }

    .header-btn.primary:hover {
      background: #333;
    }

    .cart-btn::before {
      content: "üõí";
    }

    .home-btn::before {
      content: "üè†";
    }

    .login-btn::before {
      content: "üë§";
    }

    .finder-btn::before {
      content: "üîç";
    }

    /* Navigation Menu */
    .nav-menu {
      position: fixed;
      top: 0;
      right: -350px;
      width: 300px;
      height: 100vh;
      background: white;
      box-shadow: -5px 0 15px rgba(0, 0, 0, 0.1);
      transition: right 0.3s ease;
      padding: 2rem;
      z-index: 2000;
    }

    .nav-menu.active {
      right: 0;
    }

    .nav-close {
      background: none;
      border: none;
      font-size: 1.5rem;
      cursor: pointer;
      float: left;
      margin-bottom: 2rem;
    }

    .nav-item,
    .nav-menu a,
    .nav-menu button {
      display: block;
      padding: 0.75rem 0;
      color: #1a1a1a;
      text-decoration: none;
      font-weight: 500;
      border-bottom: 1px solid #f0f0f0;
      transition: color 0.2s ease;
      background: none;
      border: none;
      text-align: right;
      width: 100%;
      cursor: pointer;
    }

    .nav-item:hover,
    .nav-menu a:hover,
    .nav-menu button:hover {
      color: #ffffcc;
    }

    /* Overlay */
    .overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      z-index: 1500;
      opacity: 0;
      visibility: hidden;
      transition: all 0.3s ease;
    }

    .overlay.active {
      opacity: 1;
      visibility: visible;
    }

    /* Main Content */
    .main-content {
      max-width: 1200px;
      margin: 0 auto;
      padding: 2rem;
    }

    .page-header {
      text-align: center;
      margin-bottom: 2rem;
    }

    .page-title {
      font-size: 3rem;
      font-weight: 900;
      color: #1a1a1a;
      margin-bottom: 1rem;
      letter-spacing: -0.02em;
      text-transform: uppercase;
    }

    /* Finder Container */
    .finder-container {
      background: white;
      border-radius: 20px;
      box-shadow: 0 5px 20px rgba(0, 0, 0, 0.08);
      padding: 2rem;
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }

    .finder-container::before {
      content: '';
      position: absolute;
      right: 0;
      top: 0;
      bottom: 0;
      width: 4px;
      background: #ffffcc;
    }

    /* Quiz Section */
    .quiz-section {
      margin-bottom: 2rem;
    }

    .progress-bar {
      background: #f0f0f0;
      height: 8px;
      border-radius: 20px;
      overflow: hidden;
      margin-bottom: 2rem;
    }

    .progress-fill {
      background: linear-gradient(90deg, #ff6b9d 0%, #ffffcc 100%);
      height: 100%;
      transition: width 0.5s ease;
      border-radius: 20px;
    }

    .question-header {
      background: linear-gradient(135deg, #1a1a1a 0%, #333 100%);
      color: white;
      padding: 2rem;
      border-radius: 16px;
      margin-bottom: 2rem;
      text-align: center;
    }

    .question-title {
      font-size: 1.5rem;
      font-weight: 700;
      margin: 0 0 0.5rem 0;
    }

    .question-subtitle {
      font-size: 1rem;
      opacity: 0.9;
      margin: 0;
    }

    .options-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 1rem;
      margin: 2rem 0;
    }

    .option-card {
      background: #f8f8f8;
      border: 2px solid transparent;
      border-radius: 16px;
      padding: 1.5rem;
      cursor: pointer;
      transition: all 0.2s ease;
      text-align: center;
      position: relative;
      overflow: hidden;
    }

    .option-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: #ffffcc;
      transform: scaleX(0);
      transition: transform 0.2s ease;
      transform-origin: right;
    }

    .option-card:hover {
      border-color: #1a1a1a;
      transform: translateY(-4px);
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
      background: #ffffcc;
    }

    .option-card:hover::before {
      transform: scaleX(1);
    }

    .option-card.selected {
      border-color: #1a1a1a;
      background: #1a1a1a;
      color: white;
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
    }

    .option-card.selected::before {
      transform: scaleX(1);
      background: white;
    }

    .option-emoji {
      font-size: 2.5rem;
      margin-bottom: 1rem;
      display: block;
    }

    .option-title {
      font-weight: 700;
      font-size: 1.1rem;
      margin-bottom: 0.5rem;
    }

    .option-description {
      font-size: 0.9rem;
      opacity: 0.8;
      line-height: 1.4;
    }

    .quiz-navigation {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 2rem;
    }

    .quiz-btn {
      background: #1a1a1a;
      color: white;
      border: none;
      padding: 1rem 2rem;
      border-radius: 20px;
      font-weight: 600;
      font-size: 1rem;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .quiz-btn:hover:not(:disabled) {
      background: #333;
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0,0,0,0.2);
    }

    .quiz-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
    }

    .quiz-btn.primary {
      background: linear-gradient(135deg, #ff6b9d 0%, #c44569 100%);
    }

    .quiz-btn.primary:hover:not(:disabled) {
      background: linear-gradient(135deg, #ff5a8a 0%, #b23a56 100%);
    }

    #question-counter {
      font-weight: 600;
      color: #666;
    }

    /* Results Section */
    .results-section {
      display: none;
    }

    .results-header {
      background: linear-gradient(135deg, #ff6b9d 0%, #c44569 100%);
      color: white;
      padding: 2rem;
      border-radius: 20px;
      margin-bottom: 2rem;
      text-align: center;
    }

    .results-title {
      font-size: 2rem;
      font-weight: 700;
      margin-bottom: 0.5rem;
    }

    .results-subtitle {
      font-size: 1.2rem;
      opacity: 0.9;
    }

    .recommendation-cards {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 2rem;
      margin: 2rem 0;
    }

    .recommendation-card {
      background: white;
      border-radius: 20px;
      padding: 1.5rem;
      box-shadow: 0 5px 20px rgba(0, 0, 0, 0.08);
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
      border: 2px solid transparent;
    }

    .recommendation-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 6px;
      background: #ffffcc;
    }

    .recommendation-card:hover {
      transform: translateY(-8px);
      box-shadow: 0 15px 40px rgba(0, 0, 0, 0.12);
    }

    .recommendation-card.perfect-match {
      border-color: #ff6b9d;
    }

    .recommendation-card.perfect-match::before {
      background: linear-gradient(90deg, #ff6b9d 0%, #c44569 100%);
      height: 8px;
    }

    .match-badge {
      background: linear-gradient(135deg, #ff6b9d 0%, #c44569 100%);
      color: white;
      padding: 8px 16px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 700;
      margin-bottom: 1rem;
      display: inline-block;
    }

    .recommendation-image {
      width: 100%;
      height: 200px;
      object-fit: cover;
      border-radius: 12px;
      margin-bottom: 1rem;
    }

    .recommendation-title {
      font-size: 1.3rem;
      font-weight: 700;
      margin-bottom: 0.5rem;
      color: #1a1a1a;
    }

    .recommendation-price {
      font-size: 1.1rem;
      font-weight: 700;
      color: #1a1a1a;
      margin-bottom: 1rem;
    }

    .recommendation-description {
      font-size: 0.9rem;
      color: #666;
      line-height: 1.5;
      margin-bottom: 1rem;
    }

    .recommendation-reasons {
      background: rgba(255, 255, 204, 0.3);
      border-radius: 12px;
      padding: 1rem;
      margin-bottom: 1rem;
      border-right: 3px solid #1a1a1a;
    }

    .recommendation-reasons h4 {
      font-size: 0.9rem;
      font-weight: 700;
      color: #1a1a1a;
      margin: 0 0 0.5rem 0;
    }

    .recommendation-reasons ul {
      list-style: none;
      padding: 0;
      margin: 0;
    }

    .recommendation-reasons li {
      font-size: 0.8rem;
      color: #666;
      margin-bottom: 0.25rem;
      position: relative;
      padding-right: 16px;
    }

    .recommendation-reasons li::before {
      content: "‚úì";
      position: absolute;
      right: 0;
      color: #1a1a1a;
      font-weight: bold;
    }

    .add-to-cart-btn {
      background: #1a1a1a;
      color: white;
      border: none;
      padding: 1rem;
      border-radius: 12px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
      width: 100%;
    }

    .add-to-cart-btn:hover {
      background: #333;
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0,0,0,0.2);
    }

    .restart-quiz {
      background: none;
      border: 2px solid #1a1a1a;
      color: #1a1a1a;
      padding: 1rem 2rem;
      border-radius: 20px;
      font-weight: 600;
      font-size: 1rem;
      cursor: pointer;
      transition: all 0.2s ease;
      margin: 2rem auto;
      display: block;
    }

    .restart-quiz:hover {
      background: #1a1a1a;
      color: white;
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0,0,0,0.2);
    }

    .loading-box {
      text-align: center;
      padding: 3rem;
      font-size: 1.1rem;
      color: #666;
    }

    /* Animations */
    @keyframes slideInRight {
      from {
        opacity: 0;
        transform: translateX(-30px);
      }
      to {
        opacity: 1;
        transform: translateX(0);
      }
    }

    .question-slide-in {
      animation: slideInRight 0.5s ease;
    }

    /* Dark Theme */
    .dark-theme {
      background: #1a1a1a;
      color: white;
    }

    .dark-theme .header {
      background: #2d2d2d;
    }

    .dark-theme .nav-menu {
      background: #2d2d2d;
    }

    .dark-theme .nav-menu a,
    .dark-theme .nav-menu button {
      color: white;
      border-bottom-color: #444;
    }

    .dark-theme .finder-container,
    .dark-theme .recommendation-card {
      background: #2d2d2d;
    }

    .dark-theme .question-title,
    .dark-theme .recommendation-title {
      color: white;
    }

    .dark-theme .option-card {
      background: #444;
      color: white;
    }

    .dark-theme .option-card:hover {
      background: #555;
    }

    .dark-theme .option-card.selected {
      background: #ffffcc;
      color: #1a1a1a;
    }

    .dark-theme .quiz-btn {
      background: #ffffcc;
      color: #1a1a1a;
    }

    .dark-theme .quiz-btn:hover:not(:disabled) {
      background: #fff;
    }

    .dark-theme .recommendation-reasons {
      background: rgba(45, 45, 45, 0.5);
      border-color: #ffffcc;
    }

    .dark-theme .add-to-cart-btn {
      background: #ffffcc;
      color: #1a1a1a;
    }

    .dark-theme .add-to-cart-btn:hover {
      background: #fff;
    }

    /* Hide old nav but NOT the slide-out menu */
    body > nav:not(.nav-menu) {
    display: none;
    }

    /* Responsive Design */
    @media (max-width: 768px) {
      .header {
        padding: 1rem;
        flex-wrap: wrap;
        gap: 1rem;
      }

      .header-left {
        order: 1;
      }

      .logo {
        font-size: 1.8rem;
        order: 2;
      }

      .header-nav {
        order: 3;
        width: 100%;
        justify-content: center;
        gap: 0.5rem;
      }

      .header-btn {
        padding: 0.4rem 0.6rem;
        font-size: 0.75rem;
      }

      .main-content {
        padding: 1rem;
      }

      .page-title {
        font-size: 2rem;
      }

      .finder-container {
        padding: 1.5rem;
        border-radius: 16px;
      }

      .options-grid {
        grid-template-columns: 1fr;
      }

      .quiz-navigation {
        flex-direction: column;
        gap: 1rem;
      }

      .recommendation-cards {
        grid-template-columns: 1fr;
      }
    }

    @media (max-width: 480px) {
      .header-btn {
        padding: 0.3rem 0.5rem;
        font-size: 0.7rem;
      }

      .header-btn::before {
        display: none;
      }
    }
  </style>
</head>
<body>
  <div class="overlay" id="overlay"></div>
  
  <header class="header">
    <div class="header-left">
      <button class="menu-btn" id="menuBtn">Menu</button>
      <a href="/" class="logo">dessert</a>
    </div>
    
    <nav class="header-nav">
      <a href="/screens/index.html" class="header-btn home-btn">◊ë◊ô◊™</a>
      <a href="/screens/cart.html" class="header-btn cart-btn">◊°◊ú ◊ß◊†◊ô◊ï◊™</a>
      <a href="/screens/dessert-finder.html" class="header-btn finder-btn primary">◊û◊¶◊ô◊ê◊™ ◊ß◊ô◊†◊ï◊ó</a>
      <a href="/screens/login.html" class="header-btn login-btn" id="header-login">◊î◊™◊ó◊ë◊®◊ï◊™</a>
    </nav>
  </header>

  <nav class="nav-menu" id="navMenu">
    <button class="nav-close" id="navClose">√ó</button>
    <a href="/screens/store.html">◊ó◊†◊ï◊™</a>
    <a href="/screens/cart.html">◊°◊ú ◊î◊ß◊†◊ô◊ï◊™</a>
    <a href="/screens/checkout.html">◊™◊©◊ú◊ï◊ù</a>
    <a href="/screens/myitems.html">◊î◊®◊õ◊ô◊©◊ï◊™ ◊©◊ú◊ô</a>
    <a id="login-link" href="/screens/login.html">◊î◊™◊ó◊ë◊®◊ï◊™</a>
    <button id="logout" style="display:none">◊î◊™◊†◊™◊ß◊ï◊™</button>
    <a href="/screens/admin.html" id="admin-link" style="display:none">◊†◊ô◊î◊ï◊ú</a>
    <a href="/screens/cake-designer.html">üé® ◊¢◊ô◊¶◊ï◊ë ◊¢◊ï◊í◊î</a>
    <a href="/screens/wheel.html">üé° ◊í◊ú◊í◊ú ◊û◊ñ◊ú</a>
    <a href="/screens/dessert-finder.html">üîç ◊û◊¶◊ô◊ê◊™ ◊ß◊ô◊†◊ï◊ó</a>
    <button id="theme-toggle">üåô ◊û◊¶◊ë ◊õ◊î◊î</button>
    <button id="language-toggle">üåê English</button>
  </nav>

  <main class="main-content">
    <div class="page-header">
      <h1 class="page-title">üîç ◊û◊¶◊ô◊ê◊™ ◊î◊ß◊ô◊†◊ï◊ó ◊î◊û◊ï◊©◊ú◊ù</h1>
    </div>

    <div class="finder-container">
      <!-- ◊ó◊ô◊ì◊ï◊ü -->
      <div id="quiz-section" class="quiz-section">
        <div class="progress-bar"><div class="progress-fill" id="progress-fill" style="width:0%"></div></div>
        <div id="question-container"></div>
        <div class="quiz-navigation">
          <button id="prev-btn" class="quiz-btn" disabled>◊©◊ê◊ú◊î ◊ß◊ï◊ì◊û◊™</button>
          <span id="question-counter">◊©◊ê◊ú◊î 1 ◊û◊™◊ï◊ö 6</span>
          <button id="next-btn" class="quiz-btn primary" disabled>◊©◊ê◊ú◊î ◊î◊ë◊ê◊î</button>
        </div>
      </div>

      <!-- ◊™◊ï◊¶◊ê◊ï◊™ -->
      <div id="results-section" class="results-section" tabindex="-1">
        <div class="results-header">
          <h2 class="results-title">◊û◊¶◊ê◊†◊ï ◊ë◊©◊ë◊ô◊ú◊ö!</h2>
          <p class="results-subtitle">◊î◊ß◊ô◊†◊ï◊ó◊ô◊ù ◊î◊û◊ï◊©◊ú◊û◊ô◊ù ◊ë◊î◊™◊ê◊ù ◊ú◊î◊¢◊ì◊§◊ï◊™ ◊©◊ú◊ö</p>
        </div>
        <div id="recommendations-container" class="recommendation-cards"></div>
        <button id="restart-quiz" class="restart-quiz">◊î◊™◊ó◊ú ◊©◊ï◊ë</button>
      </div>
    </div>
  </main>

  <script>
    // Menu functionality
    document.addEventListener('DOMContentLoaded', function() {
      const menuBtn = document.getElementById('menuBtn');
      const navMenu = document.getElementById('navMenu');
      const navClose = document.getElementById('navClose');
      const overlay = document.getElementById('overlay');

      function openMenu() {
        navMenu.classList.add('active');
        overlay.classList.add('active');
        document.body.style.overflow = 'hidden';
      }

      function closeMenu() {
        navMenu.classList.remove('active');
        overlay.classList.remove('active');
        document.body.style.overflow = 'auto';
      }

      menuBtn.addEventListener('click', openMenu);
      navClose.addEventListener('click', closeMenu);
      overlay.addEventListener('click', closeMenu);

      // Continue with the original functionality...
      initApp();
    });

    // ----- ◊†◊™◊ï◊†◊ô ◊î◊©◊ê◊ú◊ï◊™ -----
    const QUESTIONS = [
      { id:'occasion', title:'◊ê◊ô◊ñ◊î ◊ê◊ô◊®◊ï◊¢ ◊ê◊™ ◊û◊™◊õ◊†◊†◊™?', subtitle:'◊ñ◊î ◊ô◊¢◊ñ◊ï◊® ◊ú◊†◊ï ◊ú◊î◊û◊ú◊ô◊• ◊¢◊ú ◊î◊í◊ï◊ì◊ú ◊ï◊î◊°◊í◊†◊ï◊ü ◊î◊û◊™◊ê◊ô◊ù',
        options:[
          { id:'personal', emoji:'üòã', title:'◊§◊ô◊†◊ï◊ß ◊ê◊ô◊©◊ô', description:'◊®◊ß ◊ë◊©◊ë◊ô◊ú◊ô ◊ê◊ï ◊ú◊©◊†◊ô◊ô◊ù' },
          { id:'family', emoji:'üë®‚Äçüë©‚Äçüëß‚Äçüë¶', title:'◊¢◊®◊ë ◊û◊©◊§◊ó◊™◊ô', description:'3-6 ◊ê◊†◊©◊ô◊ù' },
          { id:'party', emoji:'üéâ', title:'◊û◊°◊ô◊ë◊î/◊ê◊ô◊®◊ï◊¢', description:'7+ ◊ê◊†◊©◊ô◊ù' },
          { id:'gift', emoji:'üéÅ', title:'◊û◊™◊†◊î ◊û◊ô◊ï◊ó◊ì◊™', description:'◊ú◊™◊™ ◊ú◊û◊ô◊©◊î◊ï ◊ê◊î◊ï◊ë' }
        ]},
      { id:'taste_preference', title:'◊ê◊ô◊ñ◊î ◊ò◊¢◊ù ◊î◊õ◊ô ◊û◊¢◊†◊ô◊ô◊ü ◊ê◊ï◊™◊ö?', subtitle:'◊ë◊ï◊ê◊ô ◊†◊û◊¶◊ê ◊ê◊™ ◊î◊ò◊¢◊ù ◊©◊ô◊í◊®◊ï◊ù ◊ú◊ö ◊ú◊î◊™◊û◊ï◊í◊í',
        options:[
          { id:'chocolate', emoji:'üç´', title:'◊©◊ï◊ß◊ï◊ú◊ì ◊¢◊©◊ô◊®', description:'◊ê◊î◊ë◊™ ◊©◊ï◊ß◊ï◊ú◊ì ◊ê◊û◊ô◊™◊ô◊™' },
          { id:'fruity', emoji:'üçä', title:'◊§◊ô◊®◊ï◊™◊ô ◊ï◊®◊¢◊†◊ü', description:'◊™◊§◊ï◊ñ◊ô◊ù ◊ï◊ò◊¢◊û◊ô◊ù ◊®◊¢◊†◊†◊ô◊ù' },
          { id:'sweet_treats', emoji:'üçØ', title:'◊û◊™◊ï◊ß ◊ï◊ó◊û◊î', description:'◊ú◊ï◊ò◊ï◊°, ◊†◊ï◊ò◊ú◊î, ◊ß◊®◊û◊ú' },
          { id:'mixed', emoji:'üåà', title:'◊ê◊ï◊î◊ë◊™ ◊î◊õ◊ú', description:'◊§◊™◊ï◊ó◊î ◊ú◊î◊§◊™◊¢◊ï◊™' }
        ]},
      { id:'texture', title:'◊ê◊ô◊ñ◊î ◊û◊®◊ß◊ù ◊î◊õ◊ô ◊û◊ï◊©◊ú◊ù ◊ë◊©◊ë◊ô◊ú◊ö?', subtitle:'◊î◊ò◊ß◊°◊ò◊ï◊®◊î ◊û◊©◊§◊ô◊¢◊î ◊¢◊ú ◊õ◊ú ◊î◊ó◊ï◊ï◊ô◊î',
        options:[
          { id:'soft_cake', emoji:'üßΩ', title:'◊¢◊ï◊í◊î ◊®◊õ◊î ◊ï◊°◊§◊ï◊í◊ô◊™', description:'◊†◊û◊°◊™ ◊ë◊§◊î' },
          { id:'crunchy', emoji:'ü•®', title:'◊§◊®◊ô◊ö ◊ï◊§◊®◊ô◊ö', description:'◊¢◊ï◊í◊ô◊ï◊™ ◊¢◊ù ◊†◊©◊ô◊õ◊î' },
          { id:'creamy', emoji:'üç∞', title:'◊ß◊®◊û◊ô ◊ï◊ó◊ú◊ß', description:'◊ß◊ê◊§◊ß◊ô◊ô◊ß◊° ◊¢◊ù ◊ß◊®◊ù' },
          { id:'mixed_texture', emoji:'üéØ', title:'◊©◊ô◊ú◊ï◊ë ◊û◊®◊ß◊û◊ô◊ù', description:'◊®◊ö ◊ï◊ß◊®◊ô◊°◊§◊ô ◊ë◊ô◊ó◊ì' }
        ]},
      { id:'dietary', title:'◊ô◊© ◊î◊í◊ë◊ú◊ï◊™ ◊™◊ñ◊ï◊†◊™◊ô◊ï◊™ ◊©◊õ◊ì◊ê◊ô ◊ú◊ì◊¢◊™?', subtitle:'◊†◊ï◊ï◊ì◊ê ◊©◊î◊û◊ï◊¶◊® ◊û◊™◊ê◊ô◊ù ◊ú◊ö',
        options:[
          { id:'none', emoji:'‚ú®', title:'◊ú◊ú◊ê ◊î◊í◊ë◊ú◊ï◊™', description:'◊ê◊ï◊õ◊ú◊™ ◊î◊õ◊ú ◊ë◊™◊ô◊ê◊ë◊ï◊ü' },
          { id:'nuts_aware', emoji:'ü•ú', title:'◊†◊ñ◊î◊®◊™ ◊û◊ê◊í◊ï◊ñ◊ô◊ù', description:'◊ê◊ú◊®◊í◊ô◊î ◊ê◊ï ◊î◊¢◊ì◊§◊î' },
          { id:'light', emoji:'ü™∂', title:'◊û◊©◊î◊ï ◊ß◊ú ◊ô◊ï◊™◊®', description:'◊ú◊ê ◊õ◊ë◊ì ◊û◊ì◊ô' },
          { id:'portions', emoji:'üìè', title:'◊û◊†◊ï◊™ ◊ê◊ô◊©◊ô◊ï◊™', description:'◊û◊¢◊ì◊ô◊§◊î ◊û◊†◊ï◊™ ◊ß◊ò◊†◊ï◊™' }
        ]},
      { id:'budget', title:'◊ê◊ô◊ñ◊î ◊™◊ß◊¶◊ô◊ë ◊†◊ï◊ó ◊ú◊ö?', subtitle:'◊†◊û◊¶◊ê ◊û◊©◊î◊ï ◊û◊ï◊©◊ú◊ù ◊ë◊ò◊ï◊ï◊ó ◊î◊û◊ó◊ô◊®◊ô◊ù ◊©◊ú◊ö',
        options:[
          { id:'budget', emoji:'üí∞', title:'◊¢◊ì 100 ‚Ç™', description:'◊û◊©◊î◊ï ◊†◊ó◊û◊ì ◊ï◊ë◊û◊ó◊ô◊® ◊†◊ï◊ó' },
          { id:'medium', emoji:'üí≥', title:'100-200 ‚Ç™', description:'◊û◊ï◊õ◊†◊î ◊ú◊î◊©◊ß◊ô◊¢ ◊ë◊ê◊ô◊õ◊ï◊™' },
          { id:'premium', emoji:'üíé', title:'200+ ‚Ç™', description:'◊û◊ó◊§◊©◊™ ◊û◊©◊î◊ï ◊û◊ô◊ï◊ó◊ì' },
          { id:'flexible', emoji:'üéØ', title:'◊í◊û◊ô◊©◊î', description:'◊™◊ú◊ï◊ô ◊ë◊û◊î ◊©◊û◊™◊ê◊ô◊ù' }
        ]},
      { id:'presentation', title:'◊õ◊û◊î ◊ó◊©◊ï◊ë ◊ú◊ö ◊î◊û◊®◊ê◊î ◊ï◊î◊¢◊ô◊¶◊ï◊ë?', subtitle:'◊ñ◊î ◊û◊©◊§◊ô◊¢ ◊¢◊ú ◊î◊ë◊ó◊ô◊®◊î ◊ë◊ô◊ü ◊û◊ï◊¶◊®◊ô◊ù ◊§◊©◊ï◊ò◊ô◊ù ◊ú◊û◊¢◊ï◊¶◊ë◊ô◊ù',
        options:[
          { id:'simple', emoji:'ü§é', title:'◊§◊©◊ï◊ò ◊ï◊ò◊¢◊ô◊ù', description:'◊î◊ò◊¢◊ù ◊û◊¢◊ú ◊î◊õ◊ú' },
          { id:'nice', emoji:'üì∏', title:'◊ô◊§◊î ◊ú◊™◊û◊ï◊†◊ï◊™', description:'◊†◊ó◊û◊ì ◊ú◊î◊¶◊ô◊í' },
          { id:'wow', emoji:'üåü', title:'◊û◊©◊î◊ï ◊©◊û◊®◊©◊ô◊ù', description:'◊ú◊î◊§◊™◊ô◊¢ ◊ï◊ú◊ë◊ú◊ï◊ò' },
          { id:'custom', emoji:'üé®', title:'◊û◊ï◊™◊ê◊ù ◊ê◊ô◊©◊ô◊™', description:'◊¢◊ô◊¶◊ï◊ë ◊ë◊î◊™◊ê◊û◊î ◊ê◊ô◊©◊ô◊™' }
        ]}
    ];

    // ----- ◊û◊¶◊ë ◊ê◊§◊ú◊ô◊ß◊¶◊ô◊î -----
    let currentQuestion = 0;
    let answers = {};
    let isAuthenticated = false;

    // ----- DOM -----
    const questionContainer = document.getElementById('question-container');
    const prevBtn = document.getElementById('prev-btn');
    const nextBtn = document.getElementById('next-btn');
    const questionCounter = document.getElementById('question-counter');
    const progressFill = document.getElementById('progress-fill');
    const quizSection = document.getElementById('quiz-section');
    const resultsSection = document.getElementById('results-section');
    const recommendationsContainer = document.getElementById('recommendations-container');
    const restartBtn = document.getElementById('restart-quiz');

    // ----- ◊ê◊™◊ó◊ï◊ú -----
    async function initApp() {
      loadUICustomization();
      await checkAuth();      // ◊û◊í◊ì◊ô◊® isAuthenticated
      await setupAuth();      //  ◊ò◊ï◊¢◊ü ◊ê◊™ ◊î◊™◊§◊®◊ô◊ò ◊ú◊§◊ô ◊û◊¶◊ë ◊î◊î◊™◊ó◊ë◊®◊ï◊™
      showQuestion(0);
    }

    // ----- ◊ê◊ô◊û◊ï◊™ -----
    async function checkAuth() {
      try {
        const response = await fetch('/api/session');
        isAuthenticated = response.ok;
      } catch { 
        isAuthenticated = false; 
      }
    }

    async function setupAuth() {
      try {
        const r = await fetch('/api/session');
        if (r.ok) {
          const data = await r.json();
          const headerLogin = document.getElementById('header-login');
          const loginLink = document.getElementById('login-link');
          const logoutBtn = document.getElementById('logout');
          const adminLink = document.getElementById('admin-link');
          
          if (headerLogin) headerLogin.style.display = 'none';
          if (loginLink) loginLink.style.display = 'none';
          if (logoutBtn) logoutBtn.style.display = '';
          if (adminLink && data.username === 'admin') {
            adminLink.style.display = '';
          }
          isAuthenticated = true;
        }
      } catch {}
    }

    const logoutBtn = document.getElementById('logout');
    if (logoutBtn) {
      logoutBtn.onclick = async () => {
        try { 
          await fetch('/api/logout', { method: 'POST' }); 
        } finally { 
          location.href = '/screens/login.html'; 
        }
      };
    }

    // ----- UI -----
    function loadUICustomization() {
      const theme = localStorage.getItem('theme') || 'light';
      const themeToggle = document.getElementById('theme-toggle');
      
      if (theme === 'dark') {
        document.body.classList.add('dark-theme');
        if (themeToggle) themeToggle.textContent = '‚òÄÔ∏è ◊û◊¶◊ë ◊ë◊î◊ô◊®';
      } else {
        if (themeToggle) themeToggle.textContent = 'üåô ◊û◊¶◊ë ◊õ◊î◊î';
      }
      
      const lang = localStorage.getItem('language') || 'he';
      const languageToggle = document.getElementById('language-toggle');
      if (languageToggle) {
        languageToggle.textContent = lang === 'en' ? 'üåê ◊¢◊ë◊®◊ô◊™' : 'üåê English';
      }
    }

    const themeToggle = document.getElementById('theme-toggle');
    if (themeToggle) {
      themeToggle.addEventListener('click', () => {
        const isDark = document.body.classList.contains('dark-theme');
        localStorage.setItem('theme', isDark ? 'light' : 'dark');
        loadUICustomization();
      });
    }

    // ----- ◊î◊¶◊í◊™ ◊©◊ê◊ú◊î -----
    function showQuestion(index) {
      if (index < 0 || index >= QUESTIONS.length) return;

      currentQuestion = index;
      const q = QUESTIONS[index];

      // Progress
      const progress = ((index + 1) / QUESTIONS.length) * 100;
      progressFill.style.width = `${progress}%`;

      // Counter
      questionCounter.textContent = `◊©◊ê◊ú◊î ${index + 1} ◊û◊™◊ï◊ö ${QUESTIONS.length}`;

      // Render
      questionContainer.innerHTML = `
        <div class="question-slide-in">
          <div class="question-header">
            <h2 class="question-title">${q.title}</h2>
            <p class="question-subtitle">${q.subtitle}</p>
          </div>
          <div class="options-grid">
            ${q.options.map(opt => `
              <div class="option-card" data-value="${opt.id}" onclick="selectOption('${q.id}', '${opt.id}')">
                <span class="option-emoji">${opt.emoji}</span>
                <div class="option-title">${opt.title}</div>
                <div class="option-description">${opt.description}</div>
              </div>
            `).join('')}
          </div>
        </div>
      `;

      // Restore selection
      if (answers[q.id]) {
        const selectedCard = questionContainer.querySelector(`[data-value="${answers[q.id]}"]`);
        if (selectedCard) selectedCard.classList.add('selected');
      }

      prevBtn.disabled = index === 0;
      nextBtn.disabled = !answers[q.id];
      nextBtn.textContent = index === QUESTIONS.length - 1 ? '◊¶◊§◊î ◊ë◊™◊ï◊¶◊ê◊ï◊™' : '◊©◊ê◊ú◊î ◊î◊ë◊ê◊î';
    }

    // ----- ◊ë◊ó◊ô◊®◊î -----
    function selectOption(questionId, optionId) {
      answers[questionId] = optionId;

      const cards = questionContainer.querySelectorAll('.option-card');
      cards.forEach(card => card.classList.remove('selected'));

      const selectedCard = questionContainer.querySelector(`[data-value="${optionId}"]`);
      if (selectedCard) {
        selectedCard.classList.add('selected');
        selectedCard.style.transform = 'scale(0.97)';
        setTimeout(() => { selectedCard.style.transform = ''; }, 150);
      }

      nextBtn.disabled = false;
    }

    // ----- API: ◊î◊û◊ú◊¶◊ï◊™ -----
    async function calculateRecommendations() {
      try {
        const response = await fetch('/api/dessert-finder/recommendations', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ answers })
        });
        if (!response.ok) throw new Error('Failed to get recommendations');
        const data = await response.json();
        return Array.isArray(data.recommendations) ? data.recommendations : [];
      } catch (error) {
        console.error('Error getting recommendations:', error);
        return [];
      }
    }

    // ----- ◊™◊ï◊¶◊ê◊ï◊™ -----
    async function showResults() {
      // ◊û◊¶◊ë ◊ò◊¢◊ô◊†◊î
      recommendationsContainer.innerHTML = `<div class="loading-box">◊ò◊ï◊¢◊ü ◊î◊™◊ê◊û◊ï◊™ ◊ú◊ß◊ô◊†◊ï◊ó◊ô◊ù‚Ä¶</div>`;
      quizSection.style.display = 'none';
      resultsSection.style.display = 'block';

      const recommendations = await calculateRecommendations();

      if (!recommendations.length) {
        recommendationsContainer.innerHTML = `
          <div style="text-align:center; padding:40px;">
            <h3>◊ê◊ï◊§◊°! ◊ú◊ê ◊û◊¶◊ê◊†◊ï ◊î◊™◊ê◊û◊î ◊û◊ï◊©◊ú◊û◊™</h3>
            <p>◊†◊°◊ô ◊ú◊©◊†◊ï◊™ ◊ó◊ú◊ß ◊û◊î◊™◊©◊ï◊ë◊ï◊™ ◊ê◊ï ◊§◊†◊ô ◊ê◊ú◊ô◊†◊ï ◊ú◊ô◊ô◊¢◊ï◊• ◊ê◊ô◊©◊ô</p>
          </div>
        `;
      } else {
        recommendationsContainer.innerHTML = recommendations.map((product) => `
          <div class="recommendation-card ${product.matchLevel === 'perfect' ? 'perfect-match' : ''}">
            ${product.matchLevel === 'perfect' ? '<div class="match-badge">‚≠ê ◊î◊î◊™◊ê◊û◊î ◊î◊ò◊ï◊ë◊î ◊ë◊ô◊ï◊™◊®</div>' : ''}
            <img src="/images/${product.image}" alt="${product.title}" class="recommendation-image" onerror="this.src='/images/placeholder.png'">
            <h3 class="recommendation-title">${product.title}</h3>
            <div class="recommendation-price">‚Ç™${product.price}</div>
            <p class="recommendation-description">${product.description || ''}</p>
            <div class="recommendation-reasons">
              <h4>◊ú◊û◊î ◊ñ◊î ◊û◊™◊ê◊ô◊ù ◊ú◊ö:</h4>
              <ul>${(product.reasons || []).map(r => `<li>${r}</li>`).join('')}</ul>
            </div>
            <button class="add-to-cart-btn" onclick="addToCart('${product.id}', '${product.title}', this)">
              ◊î◊ï◊°◊£ ◊ú◊°◊ú ◊î◊ß◊†◊ô◊ï◊™
            </button>
          </div>
        `).join('');
      }

      resultsSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
      resultsSection.focus();
    }

    // ----- ◊î◊ï◊°◊§◊î ◊ú◊°◊ú -----
    async function addToCart(productId, productTitle, buttonEl) {
      if (!isAuthenticated) {
        alert('◊ô◊© ◊ú◊î◊™◊ó◊ë◊® ◊õ◊ì◊ô ◊ú◊î◊ï◊°◊ô◊£ ◊û◊ï◊¶◊®◊ô◊ù ◊ú◊°◊ú');
        window.location.href = '/screens/login.html';
        return;
      }

      try {
        const response = await fetch('/api/cart', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ productId })
        });

        if (!response.ok) throw new Error('Failed to add to cart');

        const originalText = buttonEl.textContent;
        buttonEl.textContent = '‚úì ◊†◊ï◊°◊£ ◊ú◊°◊ú!';
        buttonEl.style.background = '#28a745';
        buttonEl.style.transform = 'scale(0.98)';
        setTimeout(() => {
          buttonEl.textContent = originalText;
          buttonEl.style.background = '';
          buttonEl.style.transform = '';
        }, 1800);
      } catch (error) {
        console.error('Error adding to cart:', error);
        alert('◊©◊í◊ô◊ê◊î ◊ë◊î◊ï◊°◊§◊î ◊ú◊°◊ú. ◊†◊°◊ô ◊©◊ï◊ë.');
      }
    }

    // ----- ◊î◊™◊ó◊ú◊î ◊û◊ó◊ì◊© -----
    function restartQuiz() {
      currentQuestion = 0;
      answers = {};
      quizSection.style.display = 'block';
      resultsSection.style.display = 'none';
      showQuestion(0);
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    // ----- ◊û◊ê◊ñ◊ô◊†◊ô◊ù -----
    prevBtn.addEventListener('click', () => { 
      if (currentQuestion > 0) showQuestion(currentQuestion - 1); 
    });
    
    nextBtn.addEventListener('click', () => { 
      if (currentQuestion < QUESTIONS.length - 1) {
        showQuestion(currentQuestion + 1); 
      } else {
        showResults(); 
      }
    });
    
    restartBtn.addEventListener('click', restartQuiz);

    // ◊ó◊©◊ô◊§◊î ◊ú◊í◊ú◊ï◊ë◊ú◊ô
    window.selectOption = selectOption;
    window.addToCart = addToCart;
  </script>
</body>
</html>