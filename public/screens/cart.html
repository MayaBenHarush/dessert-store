<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>住 拽转</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="/assets/styles.css" />
  <style>
    body {
      background: linear-gradient(135deg, rgba(255,107,157,0.06), rgba(78,205,196,0.06));
      font-family: "Segoe UI", Tahoma, sans-serif;
      margin: 0;
    }

    nav {
      display:flex;
      justify-content:center;
      gap:12px;
      padding:14px 20px;
      background: #fff;
      box-shadow: 0 2px 8px rgba(0,0,0,.06);
      position:sticky;
      top:0;
      z-index:10;
    }
    nav a, nav button {
      background: none;
      border:none;
      font-weight:600;
      color:#444;
      font-size:.95rem;
      cursor:pointer;
      padding:8px 14px;
      border-radius: 8px;
      transition:.2s ease;
    }
    nav a:hover, nav button:hover {
      background: rgba(255,107,157,0.1);
      color:#ff437d;
    }

    h1 {
      text-align:center;
      margin: 30px 0 20px;
      font-size:2rem;
      color:#333;
    }

    .cart-list {
      max-width:700px;
      margin:0 auto 60px;
      display:flex;
      flex-direction:column;
      gap:14px;
      padding:0 16px;
    }

    .cart-item {
      display:flex;
      justify-content:space-between;
      align-items:center;
      background:#fff;
      border-radius:14px;
      padding:12px 16px;
      box-shadow: 0 2px 6px rgba(0,0,0,.05);
      transition:.2s ease;
    }
    .cart-item:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 10px rgba(0,0,0,.08);
    }

    .cart-item .left {
      display:flex;
      align-items:center;
      gap:12px;
    }
    .cart-item img {
      width:60px;
      height:60px;
      object-fit:cover;
      border-radius:10px;
    }
    .cart-item h3 {
      margin:0;
      font-size:1rem;
      color:#333;
    }

    .cart-item .remove {
      border:none;
      background:#ff6b9d;
      color:#fff;
      border-radius:8px;
      padding:8px 14px;
      font-size:.9rem;
      cursor:pointer;
      transition:.2s ease;
    }
    .cart-item .remove:hover {
      background:#e24d80;
    }

    .cart-list p {
      text-align:center;
      padding:40px 20px;
      color:#777;
      background:#fff;
      border-radius:14px;
      box-shadow: 0 2px 6px rgba(0,0,0,.05);
    }
  </style>
</head>
<body>

  <nav>
    <a href="store.html"> 转</a>
    <a href="checkout.html"> 转砖</a>
    <a href="myitems.html"> 专砖转 砖</a>
    <a href="admin.html">锔 </a>
    <button id="logout"> 转转拽转</button>
  </nav>

  <h1> 住 拽转</h1>

  <div id="items" class="cart-list"></div>

  <script>
    // Logout
    document.getElementById('logout').onclick = async () => {
      try { await fetch('/api/logout', { method: 'POST' }); }
      finally { location.href = 'login.html'; }
    };

    let products = [];

    async function loadProducts() {
      const res = await fetch('/api/products');
      products = await res.json();
    }

    async function loadCart() {
      const res = await fetch('/api/cart');
      if (res.status === 401) return (location.href = 'login.html');
      const itemIds = await res.json();

      const container = document.getElementById('items');
      container.innerHTML = '';

      if (!Array.isArray(itemIds) || itemIds.length === 0) {
        container.innerHTML = '<p>住 专拽 </p>';
        return;
      }

      for (const id of itemIds) {
        const p = products.find(x => x.id === id);
        if (!p) continue;

        const row = document.createElement('div');
        row.className = 'cart-item';
        row.innerHTML = `
          <div class="left">
            <img src="/images/${p.image}" alt="${p.title}">
            <h3>${p.title}</h3>
          </div>
          <button class="remove" data-id="${p.id}">住专</button>
        `;
        container.appendChild(row);
      }
    }

    // 转 住专
    document.getElementById('items').addEventListener('click', async (e) => {
      const btn = e.target.closest('.remove');
      if (!btn) return;

      const id = btn.getAttribute('data-id');
      const del = await fetch(`/api/cart/${encodeURIComponent(id)}`, {
        method: 'DELETE'
      });

      if (del.ok) {
        loadCart();
      } else {
        let j = {};
        try { j = await del.json(); } catch {}
        alert(j.error || '砖 住专');
      }
    });

    (async () => {
      await loadProducts();
      await loadCart();
    })();
  </script>
</body>
</html>
