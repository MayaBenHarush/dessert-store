<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>LLM â€” ×§×•×“ ×©× ×•×¦×¨ ×‘×¢×–×¨×ª ×‘×™× ×” ××œ××›×•×ª×™×ª</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="/assets/styles.css" />
  <style>
    .llm-container{max-width:1000px;margin:0 auto;background:var(--bg-card);padding:40px;border-radius:20px;box-shadow:var(--shadow-lg);line-height:1.8}
    .llm-section{margin-bottom:30px;padding:20px 0;border-bottom:1px solid #eee}
    .llm-section:last-child{border-bottom:none}
    .llm-section h2{color:var(--primary-color);margin-bottom:12px}
    .hint{background:var(--bg-primary);border-right:4px solid var(--primary-color);padding:12px;border-radius:10px;margin:10px 0;color:var(--fg-muted)}
    .files-table{width:100%;border-collapse:collapse;margin:10px 0 0}
    .files-table th,.files-table td{padding:10px;border-bottom:1px solid #ececec;text-align:right;vertical-align:top}
    .tag{display:inline-block;background:#eef;border:1px solid #ccd;padding:.1rem .5rem;border-radius:999px;font-size:.8rem;margin-left:.3rem}
    details.code-block{margin:10px 0;border:1px solid #eee;border-radius:12px;overflow:hidden;background:#fafafa}
    details.code-block[open]{box-shadow:0 8px 20px rgba(0,0,0,.06)}
    details.code-block summary{cursor:pointer;list-style:none;padding:12px 14px;background:#fff;font-weight:700;display:flex;align-items:center;gap:8px}
    details.code-block summary::-webkit-details-marker{display:none}
    .code-meta{font-size:.9rem;color:#666;font-weight:500}
    .code-wrap{position:relative}
    pre{margin:0;padding:14px 16px;overflow:auto;background:#0b1021;color:#e2e8f0;font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace}
    .copy-btn{position:absolute;top:8px;left:8px;background:#222;color:#fff;border:none;border-radius:8px;padding:6px 10px;cursor:pointer;font-size:.8rem;opacity:.9}
    .copy-btn:hover{opacity:1}
    .pill{display:inline-flex;gap:8px;align-items:center;font-size:.85rem}
    .ok{color:#2e7d32}
    .warn{color:#b26a00}
    .muted{color:#6b7280}
  </style>
</head>
<body>
  <nav>
    <a href="store.html">×—× ×•×ª</a>
    <a href="cart.html">×¡×œ ×”×§× ×™×•×ª</a>
    <a href="checkout.html">×ª×©×œ×•×</a>
    <a href="myitems.html">×”×¨×›×™×©×•×ª ×©×œ×™</a>
    <a href="readme.html">ğŸ“– README</a>
    <a id="login-link" href="login.html">×”×ª×—×‘×¨×•×ª</a>
    <button id="logout" style="display:none">×”×ª× ×ª×§×•×ª</button>
    <a id="admin-link" href="admin.html" style="display:none">× ×™×”×•×œ</a>
    <button id="theme-toggle">ğŸŒ™ ××¦×‘ ×›×”×”</button>
    <button id="language-toggle" style="display:none">ğŸŒ English</button>
  </nav>

  <div class="llm-container">
    <h1> LLM â€” ×§×•×“ ×§×˜×Ÿ ×©×¡×™×™×¢ ×œ×™ (×¨×•×‘ ×”×¢×‘×•×“×” ×‘×•×¦×¢×” ×™×“× ×™×ª)</h1>

    <div class="hint">
      ×œ×”×œ×Ÿ ×›××” ××§×˜×¢×™× × ×§×•×“×ª×™×™× ×‘×”× × ×¢×–×¨×ª×™ ×‘-LLM. ×©××¨ ×”×¤×™×ª×•×— â€” ×ª×›× ×•×Ÿ, ×›×ª×™×‘×”, ××™× ×˜×’×¨×¦×™×” ×•×‘×“×™×§×•×ª â€” × ×¢×©×” ×¢×œ-×™×“×™.
    </div>

    <!-- 1) ×ª×¨×’×•× ×§×˜×Ÿ -->
    <section class="llm-section" id="i18n">
      <h2>1) ×ª×¨×’×•× ×§×˜×Ÿ ×©×œ ××¤×ª×—×•×ª UI</h2>
      <p class="pill muted">×”×™×§×£: ×§×˜×Ÿ ×××•×“ â€¢ ××˜×¨×”: × ×™×¡×•×— ××“×•×™×§ ×‘×× ×’×œ×™×ª ×œ×©× ×™ ××¤×ª×—×•×ª ×§×™×™××™×</p>
      <table class="files-table">
        <thead><tr><th>×§×•×‘×¥</th><th>×ª×™××•×¨</th><th>×œ××” ×”×©×ª××©×ª×™ ×‘-LLM</th><th>×¡×˜×˜×•×¡</th></tr></thead>
        <tbody>
          <tr>
            <td><code>assets/translations.js</code> (××§×˜×¢)</td>
            <td>×”×•×¡×¤×ª ×©× ×™ ××¤×ª×—×•×ª ×ª×¨×’×•× (he/en)</td>
            <td>×¢×–×¨×” ×‘×‘×—×™×¨×ª × ×™×¡×•×— ×× ×’×œ×™ ×§×¦×¨ ×•×ª×§× ×™</td>
            <td><span class="ok">×©×•×œ×‘</span></td>
          </tr>
        </tbody>
      </table>

      <details class="code-block">
        <summary>×”×¦×’ ×§×•×“ (×§×˜×¢ ×§×¦×¨)</summary>
        <div class="code-wrap">
          <button class="copy-btn" data-target="code-i18n">×”×¢×ª×§</button>
          <pre id="code-i18n">// assets/translations.js (snippet)
const i18n = {
  he: {
    "pageTitle.admin": "××¡×š × ×™×”×•×œ",
    "nav.diy": "×¢×©×” ×–××ª ×‘×¢×¦××š"
  },
  en: {
    "pageTitle.admin": "Admin",
    "nav.diy": "DIY"
  }
};
// ×”×¢×¨×”: ×”-LLM ×¡×™×™×¢ ×œ×‘×—×•×¨ × ×™×¡×•×— ×ª××¦×™×ª×™ ×•×§×•×”×¨× ×˜×™ ×‘×× ×’×œ×™×ª.</pre>
        </div>
      </details>
    </section>

    <!-- 2) × ×™×”×•×œ â€” ×¡× ×›×¨×•×Ÿ ××—×™×¨×™× -->
    <section class="llm-section" id="admin-prices">
      <h2>2) × ×™×”×•×œ â€” ×¡× ×›×¨×•×Ÿ ××—×™×¨×™× ××•×¦×’×™× ××•×œ × ×ª×•× ×™ ×××ª</h2>
      <p class="pill muted">×”×™×§×£: ×§×˜×Ÿ â€¢ ××˜×¨×”: ×”×™×× ×¢×•×ª ×-0â‚ª ×‘×ª×¦×•×’×” ×•×”×©×œ××ª ××—×™×¨ ×‘×¨×™×¨×ª ××—×“×œ ×¢×§×‘×™×ª</p>
      <table class="files-table">
        <thead><tr><th>×§×•×‘×¥</th><th>×ª×™××•×¨</th><th>×œ××” ×”×©×ª××©×ª×™ ×‘-LLM</th><th>×¡×˜×˜×•×¡</th></tr></thead>
        <tbody>
          <tr>
            <td><code>admin.html</code> (××§×˜×¢)</td>
            <td><code>getProductPrice()</code> + ××¤×ª ××—×™×¨×™× ×‘×¡×™×¡×™×ª</td>
            <td>×¡×™×•×¢ ×‘× ×™×¡×•×— ×œ×•×’×™×§×” ×§×¦×¨×” ×•××—×™×“×” ×‘×™×Ÿ ×“×¤×™×</td>
            <td><span class="ok">×©×•×œ×‘</span></td>
          </tr>
        </tbody>
      </table>

      <details class="code-block">
        <summary>×”×¦×’ ×§×•×“ (×§×˜×¢ ×ª×•×× ×œ×“×£ ×”× ×™×”×•×œ)</summary>
        <div class="code-wrap">
          <button class="copy-btn" data-target="code-admin">×”×¢×ª×§</button>
          <pre id="code-admin">// admin.html (snippet) â€” ×œ×•×’×™×§×ª ××—×™×¨ ×¢×§×‘×™×ª
const FALLBACK_PRICES = {
  "white-chocolate-cookie": 17,
  "white-design-cake": 140,
  "chocolate-cake": 150,
  "cookies-box": 120,
  "cupcakes": 160,
  "minnie-mous-cake": 300,
  "nutella-box": 70
};

function getProductPrice(p){
  if (typeof p.price === "number" && p.price > 0) return p.price;
  const guess = /(cookie|×¢×•×’×™)/i.test((p.id||"") + " " + (p.title||"")) ? 17 : 100;
  return FALLBACK_PRICES[p.id] ?? guess;
}

// ×©×™××•×© ×‘×ª×¦×•×’×”:
const productPrice = `â‚ª${getProductPrice(p)}`;

// ×”×¢×¨×”: ×”-LLM ×¡×™×™×¢ ×œ× ×¡×— ××ª ×”×”×©××” ×”×¢×§×‘×™×ª ×•×”-fallback ×”×§×˜×Ÿ.</pre>
        </div>
      </details>

      <details class="code-block">
        <summary>×”×¦×’ ×§×•×“ (×—×“-×¤×¢××™ ×œ×¢×“×›×•×Ÿ ××—×™×¨×™× ×—×¡×¨×™×)</summary>
        <div class="code-wrap">
          <button class="copy-btn" data-target="code-admin-init">×”×¢×ª×§</button>
          <pre id="code-admin-init">// admin.html (snippet bottom) â€” ×¨×™×¦×” ×—×“-×¤×¢××™×ª ×œ×¢×“×›×•×Ÿ ××•×¦×¨×™ 0â‚ª
async function updateExistingProductPrices(){
  try{
    const res = await fetch('/api/admin/products');
    if(!res.ok) return;
    const products = await res.json();

    const PRICE_MAP = {
      "white-chocolate-cookie": 17,
      "white-design-cake": 140,
      "chocolate-cake": 150,
      "cookies-box": 120,
      "cupcakes": 160,
      "minnie-mous-cake": 300,
      "nutella-box": 70,
      "chocolate-pizza-xl": 120,
      "bento-design-cake": 140,
      "chocolate-design-cake": 180,
      "orange-cake": 70,
      "pizza-cookie": 120
    };

    for(const product of products){
      if(!product.price || product.price === 0){
        const price = PRICE_MAP[product.id] || (/(cookie|×¢×•×’×™)/i.test(product.id + ' ' + product.title) ? 17 : 100);
        await fetch(`/api/admin/products/${encodeURIComponent(product.id)}`, {
          method: 'PUT',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ ...product, price })
        });
      }
    }
    await loadProducts();
  }catch(err){ console.error('Error updating prices:', err); }
}
// ×”×¢×¨×”: ×”-LLM ×¡×™×™×¢ ×œ×§×¦×¨ ××ª ×”×œ×•×œ××” ×•×”-fallback. ×”×•×¤×¢×œ ×¤×¢× ××—×ª ×‘×œ×‘×“.</pre>
        </div>
      </details>
    </section>

    <!-- 3) ×’×œ×’×œ ××–×œ â€” ×§×•×¤×•×Ÿ ×ª×•×× ×ª×•×¦××” -->
    <section class="llm-section" id="wheel-coupon">
      <h2>3) ×’×œ×’×œ ××–×œ â€” ×§×•×¤×•×Ÿ ×ª×•×× ×‘×“×™×•×§ ×œ×¤×¨×¡ ×©×¢×œ×™×• × ×¢×¦×¨ ×”×’×œ×’×œ</h2>
      <p class="pill muted">×”×™×§×£: ×§×˜×Ÿ â€¢ ××˜×¨×”: ×œ×× ×•×¢ ×¤×¢×¨ ×‘×™×Ÿ ×”-UI ×œ×‘×™×Ÿ ××” ×©× ×©××¨ ×‘×©×¨×ª</p>
      <table class="files-table">
        <thead><tr><th>×§×•×‘×¥</th><th>×ª×™××•×¨</th><th>×œ××” ×”×©×ª××©×ª×™ ×‘-LLM</th><th>×¡×˜×˜×•×¡</th></tr></thead>
        <tbody>
          <tr>
            <td><code>wheel.html</code> (××§×˜×¢)</td>
            <td>×©×œ×™×—×ª ×§×•×“ ×”×¤×¨×¡ ×”××“×•×™×§ ×©×”××—×•×’ × ×—×ª ×¢×œ×™×•</td>
            <td>×¡×™×•×¢ ×‘×›×ª×™×‘×” ×ª××¦×™×ª×™×ª ×©×œ ×”×©×œ×™×—×” ×œ×©×¨×ª</td>
            <td><span class="ok">×©×•×œ×‘</span></td>
          </tr>
        </tbody>
      </table>

      <details class="code-block">
        <summary>×”×¦×’ ×§×•×“ (××™×¤×•×™ ×¤×¨×¡ â†’ ×§×•×“ ×§×•×¤×•×Ÿ ×•×©×œ×™×—×” ×œ×©×¨×ª)</summary>
        <div class="code-wrap">
          <button class="copy-btn" data-target="code-wheel">×”×¢×ª×§</button>
          <pre id="code-wheel">// wheel.html (snippet)
const PRIZES = [
  { label: "5% ×”× ×—×”", code: "WHEEL5" },
  { label: "10% ×”× ×—×”", code: "WHEEL10" },
  { label: "×œ× ×–×›×™×ª", code: "NOWIN" },
  { label: "â‚ª20 ××ª× ×”", code: "GIFT20" }
];

function onWheelStopped(segmentIndex){
  const prize = PRIZES[segmentIndex];
  // ×©×œ×™×—×” ×œ×©×¨×ª â€” ×©×•××¨ ×‘×“×™×•×§ ××ª ××” ×©×”××—×•×’ ×‘×—×¨
  fetch('/api/wheel/spin', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ prizeCode: prize.code })
  })
  .then(r => r.json()).then(data => {
    // ×”×¦×’×ª ×¤×™×“×‘×§ ×œ××©×ª××©
    showToast(prize.label);
  })
  .catch(console.error);
}
// ×”×¢×¨×”: ×”-LLM ×¢×–×¨ ×œ× ×¡×— ××ª ×”×©×™×•×š ×”×¤×©×•×˜ ×•×œ×•×•×“× ×¢×§×‘×™×•×ª ×‘×™×Ÿ ×”×ª×¦×•×’×” ×œ×©×¨×ª.</pre>
        </div>
      </details>
    </section>

    <!-- 4) ×§×œ×™×œ: ×›×¤×ª×•×¨ ×”×¢×ª×§×” ×œ×‘×œ×•×§×™ ×§×•×“ ×‘×“×£ ×”×–×” -->
    <section class="llm-section" id="utils">
      <h2>4) ×¢×–×¨ ×§×˜×Ÿ ×‘×ª×•×š ×”×“×£ ×”×–×” â€” ×›×¤×ª×•×¨ "×”×¢×ª×§" ×œ×‘×œ×•×§×™ ×§×•×“</h2>
      <p class="pill muted">×”×™×§×£: ××–×¢×¨×™ â€¢ ××˜×¨×”: × ×•×—×•×ª ×”×¦×’×” ×‘×œ×‘×“</p>
      <details class="code-block">
        <summary>×”×¦×’ ×§×•×“ (Utility ×§×¦×¨)</summary>
        <div class="code-wrap">
          <button class="copy-btn" data-target="code-copy">×”×¢×ª×§</button>
          <pre id="code-copy">// llm.html (snippet) â€” ×›×¤×ª×•×¨ "×”×¢×ª×§" ×œ×‘×œ×•×§×™ ×§×•×“
document.addEventListener('click', (e) => {
  const btn = e.target.closest('.copy-btn');
  if(!btn) return;
  const targetId = btn.getAttribute('data-target');
  const pre = document.getElementById(targetId);
  if(!pre) return;
  const text = pre.textContent;
  navigator.clipboard.writeText(text).then(() => {
    btn.textContent = '×”×•×¢×ª×§!';
    setTimeout(() => btn.textContent = '×”×¢×ª×§', 900);
  });
});</pre>
        </div>
      </details>
      <p class="muted">××¢×‘×¨ ×œ× ×•×—×•×ª, ××™×Ÿ ×©×™××•×© ×‘×¤×¨×•×™×§×˜ ×¢×¦××• â€” ×¨×§ ×‘×“×£ ×”×ª×™×¢×•×“ ×”×–×”.</p>
    </section>

    <div class="hint">
      ×–×”×• â€” ××œ×• ×”××§×¨×™× ×”×‘×•×“×“×™× ×‘×”× × ×¢×–×¨×ª×™ ×‘-LLM. ×›×œ ×”×©××¨ (××•×“×•×œ×™ ×©×¨×ª, ×–×¨×™××•×ª, ×¢×™×¦×•×‘, ×‘×“×™×§×•×ª, ×”×ª×××©×§×•×ª ×œ×§×‘×¦×™ JSON ×•×›×•â€™) ×¤×•×ª×—×• ×‘××•×¤×Ÿ ×¢×¦×××™.
    </div>
  </div>

  <script>
    // Dark Mode (×›××• ×‘×©××¨ ×”×“×¤×™×)
    function loadUICustomization(){
      const theme = localStorage.getItem('theme') || 'light';
      const btn = document.getElementById('theme-toggle');
      if(theme==='dark'){document.body.classList.add('dark-theme');btn.textContent='â˜€ï¸ ××¦×‘ ×‘×”×™×¨';}
      else{document.body.classList.remove('dark-theme');btn.textContent='ğŸŒ™ ××¦×‘ ×›×”×”';}
    }
    document.getElementById('theme-toggle').addEventListener('click',()=>{
      const dark = document.body.classList.contains('dark-theme');
      localStorage.setItem('theme', dark?'light':'dark');
      loadUICustomization();
    });

    // × ×™×•×•×˜ / ×›×¤×ª×•×¨×™ ×”×ª×—×‘×¨×•×ª (×™×™×©×•×¨ ×œ×§×™×™×)
    async function setupAuthButtons(){
      const loginLink=document.getElementById('login-link');
      const logoutBtn=document.getElementById('logout');
      const adminLink=document.getElementById('admin-link');
      let loggedIn=false, username='';
      try{
        const r=await fetch('/api/session');
        if(r.ok){loggedIn=true; const d=await r.json(); username=d.username;}
      }catch{}
      loginLink.style.display=loggedIn?'none':'';
      logoutBtn.style.display=loggedIn?'':'none';
      adminLink.style.display=(loggedIn && username==='admin')?'':'none';
    }
    document.getElementById('logout').onclick=async ()=>{
      try{await fetch('/api/logout',{method:'POST'});}finally{location.href='login.html';}
    };

    // Utility "×”×¢×ª×§" (×¤×•×¢×œ ×’× ×‘×œ×™ ×©×™× ×•×™)
    document.addEventListener('click', (e) => {
      const btn = e.target.closest('.copy-btn');
      if(!btn) return;
      const targetId = btn.getAttribute('data-target');
      const pre = document.getElementById(targetId);
      if(!pre) return;
      const text = pre.textContent;
      navigator.clipboard.writeText(text).then(() => {
        btn.textContent = '×”×•×¢×ª×§!';
        setTimeout(() => btn.textContent = '×”×¢×ª×§', 900);
      });
    });

    loadUICustomization();
    setupAuthButtons();
  </script>
</body>
</html>
