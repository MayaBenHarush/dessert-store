<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title data-page="login">×”×ª×—×‘×¨×•×ª</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <script src="/assets/translations.js"></script>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
      background: #ffffff; color: #1a1a1a; line-height: 1.6;
      min-height: 100vh; display: flex; flex-direction: column;
    }

    /* Header */
    .header { background: #ffffcc; padding: 1rem 2rem; display: flex; justify-content: space-between; align-items: center; position: sticky; top: 0; z-index: 1000; box-shadow: 0 2px 10px rgba(0,0,0,.1); }
    .header-left { display: flex; align-items: center; gap: 1rem; }
    .menu-btn { background: none; border: none; font-size: 1.1rem; font-weight: 600; color: #1a1a1a; cursor: pointer; display: flex; align-items: center; gap: .5rem; }
    .menu-btn::before { content: "â˜°"; font-size: 1.2rem; }
    .logo { font-size: 2.2rem; font-weight: 900; color: #1a1a1a; text-decoration: none; letter-spacing: -0.02em; }
    .header-nav { display: flex; align-items: center; gap: 1rem; }
    .header-btn { background: none; border: 2px solid #1a1a1a; color: #1a1a1a; padding: .5rem 1rem; border-radius: 20px; font-weight: 600; font-size: .9rem; cursor: pointer; transition: all .2s ease; text-decoration: none; display: flex; align-items: center; gap: .3rem; }
    .header-btn:hover { background: #1a1a1a; color: #fff; }

    /* Navigation Menu (side) */
    .nav-menu { position: fixed; top: 0; right: -300px; width: 300px; height: 100vh; background: #fff; box-shadow: -5px 0 15px rgba(0,0,0,.1); transition: right .3s ease; padding: 2rem; z-index: 2000; }
    .nav-menu.active { right: 0; }
    .nav-close { background: none; border: none; font-size: 1.5rem; cursor: pointer; float: left; margin-bottom: 2rem; }
    .nav-item, .nav-menu a, .nav-menu button { display: block; padding: .75rem 0; color: #1a1a1a; text-decoration: none; font-weight: 500; border-bottom: 1px solid #f0f0f0; transition: color .2s ease; background: none; border: none; text-align: right; width: 100%; cursor: pointer; }
    .nav-item:hover, .nav-menu a:hover, .nav-menu button:hover { color: #ffffcc; }

    /* Overlay */
    .overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,.5); z-index: 1500; opacity: 0; visibility: hidden; transition: all .3s ease; }
    .overlay.active { opacity: 1; visibility: visible; }

    /* Main */
    .main-content { flex: 1; display: flex; justify-content: center; align-items: center; padding: 2rem; }
    .auth-container { background: #fff; border-radius: 24px; box-shadow: 0 20px 60px rgba(0,0,0,.1); padding: 3rem; max-width: 500px; width: 100%; position: relative; overflow: hidden; }
    .auth-container::before { content: ''; position: absolute; top: 0; left: 0; right: 0; height: 6px; background: #ffffcc; }
    .auth-title { font-size: 2.5rem; font-weight: 900; color: #1a1a1a; text-align: center; margin-bottom: 2rem; letter-spacing: -0.02em; text-transform: uppercase; }
    .auth-form { display: flex; flex-direction: column; gap: 1.5rem; }
    .auth-form label { display: flex; flex-direction: column; gap: .5rem; text-align: right; font-weight: 600; color: #1a1a1a; }
    .auth-form input[type="text"], .auth-form input[type="password"] { padding: 1rem 1.5rem; border: 2px solid #f0f0f0; border-radius: 12px; font-size: 1rem; transition: all .2s ease; background: #fafafa; text-align: right; }
    .auth-form input:focus { outline: none; border-color: #ffffcc; box-shadow: 0 0 0 3px rgba(255,255,204,.2); background: #fff; }
    .extras { display: flex; align-items: center; gap: .5rem; font-weight: 500; color: #666; }
    .extras input[type="checkbox"] { width: 18px; height: 18px; accent-color: #1a1a1a; }
    .actions { margin-top: 1rem; }
    .auth-form button { width: 100%; background: #1a1a1a; color: #fff; border: none; padding: 1rem 2rem; border-radius: 12px; font-weight: 700; font-size: 1rem; cursor: pointer; transition: all .2s ease; text-transform: uppercase; letter-spacing: .5px; }
    .auth-form button:hover { background: #333; transform: translateY(-2px); box-shadow: 0 8px 25px rgba(0,0,0,.15); }
    .auth-form button:active { transform: translateY(0); }

    /* Dark Theme */
    .dark-theme { background: #1a1a1a; color: #fff; }
    .dark-theme .header { background: #2d2d2d; }
    .dark-theme .nav-menu { background: #2d2d2d; }
    .dark-theme .nav-menu a, .dark-theme .nav-menu button { color: #fff; border-bottom-color: #444; }
    .dark-theme .auth-container { background: #2d2d2d; }
    .dark-theme .auth-container::before { background: #ffffcc; }
    .dark-theme .auth-title { color: #fff; }
    .dark-theme .auth-form label { color: #fff; }
    .dark-theme .auth-form input { background: #3d3d3d; border-color: #555; color: #fff; }
    .dark-theme .auth-form input:focus { background: #4d4d4d; border-color: #ffffcc; }
    .dark-theme .extras { color: #ccc; }
    .dark-theme .auth-form button { background: #ffffcc; color: #1a1a1a; }
    .dark-theme .auth-form button:hover { background: #ffff99; }

    /* Responsive */
    @media (max-width: 768px) {
      .header { padding: 1rem; flex-wrap: wrap; gap: 1rem; }
      .header-left { order: 1; }
      .logo { font-size: 1.8rem; order: 2; }
      .header-nav { order: 3; width: 100%; justify-content: center; gap: 1rem; }
      .header-btn { padding: .4rem .6rem; font-size: .75rem; }
      .main-content { padding: 1rem; }
      .auth-container { padding: 2rem; }
      .auth-title { font-size: 2rem; }
    }
    @media (max-width: 480px) {
      .header-btn { padding: .3rem .5rem; font-size: .7rem; }
      .auth-container { padding: 1.5rem; }
      .auth-title { font-size: 1.5rem; }
    }
  </style>
</head>
<body>
  <div class="overlay" id="overlay"></div>
  
  <header class="header">
    <div class="header-left">
      <button class="menu-btn" id="menuBtn">×ª×¤×¨×™×˜</button>
      <a href="/" class="logo">dessert</a>
    </div>
    
    <nav class="header-nav">
      <a href="/screens/index.html" class="header-btn" id="home-link">×‘×™×ª</a>
      <a href="/screens/store.html" class="header-btn" id="store-link">×—× ×•×ª</a>
      <a href="/screens/register.html" class="header-btn" id="register-link">×”×¨×©××”</a>
      <!-- (××™×Ÿ ×›×¤×ª×•×¨×™ ×©×¤×”/×ª××•×¨×” ×‘×›×•×ª×¨×ª; × ×©××¨×™× ×‘×ª×¤×¨×™×˜ ×”×¦×“) -->
    </nav>
  </header>

  <nav class="nav-menu" id="navMenu">
    <button class="nav-close" id="navClose">Ã—</button>
    <a href="/screens/store.html" id="nav-store">×—× ×•×ª</a>
    <a href="/screens/register.html" id="nav-register">×”×¨×©××”</a>
    <!-- ×”×›×¤×ª×•×¨×™× × ×©××¨×™× ×›××Ÿ ×‘×œ×‘×“ -->
    <button id="theme-toggle-menu">ğŸŒ™ ××¦×‘ ×›×”×”</button>
    <button id="language-toggle-menu">ğŸŒ English</button>
  </nav>

  <main class="main-content">
    <div class="auth-container">
      <h1 class="auth-title" id="page-title">×”×ª×—×‘×¨×•×ª</h1>
      
      <form id="login-form" class="auth-form" autocomplete="off">
        <label class="field-username">
          <span id="username-label">×©× ××©×ª××©</span>:
          <input type="text" name="username" autocomplete="new-password" readonly onfocus="this.removeAttribute('readonly');" required />
        </label>
        
        <label class="field-password">
          <span id="password-label">×¡×™×¡××”</span>:
          <input type="password" name="password" autocomplete="new-password" readonly onfocus="this.removeAttribute('readonly');" required />
        </label>
        
        <div class="extras">
          <input type="checkbox" name="rememberMe" id="rememberMe">
          <label for="rememberMe"><span id="remember-label">×–×›×•×¨ ××•×ª×™</span></label>
        </div>
        
        <div class="actions">
          <button type="submit" id="login-button">×”×ª×—×‘×¨×•×ª</button>
        </div>
      </form>
    </div>
  </main>

  <script>
    // --- helpers (×—×“×©: ×˜×§×¡×˜ ××¦×‘ ×ª××•×¨×” ×œ×¤×™ ×©×¤×”) ---
    function themeLabel(theme, lang){
      const isDark = theme === 'dark';
      if (lang === 'en') return isDark ? 'â˜€ï¸ Light Mode' : 'ğŸŒ™ Dark Mode';
      return isDark ? 'â˜€ï¸ ××¦×‘ ×‘×”×™×¨' : 'ğŸŒ™ ××¦×‘ ×›×”×”';
    }

    // Menu functionality
    const menuBtn = document.getElementById('menuBtn');
    const navMenu = document.getElementById('navMenu');
    const navClose = document.getElementById('navClose');
    const overlay = document.getElementById('overlay');

    function openMenu() {
      navMenu.classList.add('active');
      overlay.classList.add('active');
      document.body.style.overflow = 'hidden';
    }
    function closeMenu() {
      navMenu.classList.remove('active');
      overlay.classList.remove('active');
      document.body.style.overflow = 'auto';
    }
    menuBtn.addEventListener('click', openMenu);
    navClose.addEventListener('click', closeMenu);
    overlay.addEventListener('click', closeMenu);

    // ×˜×¢×™× ×ª ×”×ª×××•×ª
    function loadUICustomization() {
      const theme = localStorage.getItem('theme') || 'light';
      const lang  = localStorage.getItem('language') || 'he';
      const themeToggle = document.getElementById('theme-toggle'); // ×™×™×ª×›×Ÿ ×•×œ× ×§×™×™× (×”×•×¡×¨ ××”×›×•×ª×¨×ª)
      const themeToggleMenu = document.getElementById('theme-toggle-menu');

      if (theme === 'dark') {
        document.body.classList.add('dark-theme');
      } else {
        document.body.classList.remove('dark-theme');
      }
      // ×¢×“×›×•×Ÿ ×˜×§×¡×˜ ×›×¤×ª×•×¨×™ ×ª××•×¨×” ×œ×¤×™ ×©×¤×”
      if (themeToggle) themeToggle.textContent = themeLabel(theme, lang);
      if (themeToggleMenu) themeToggleMenu.textContent = themeLabel(theme, lang);

      updateLanguageDisplay();
    }

    function updateLanguageDisplay() {
      const currentLanguage = localStorage.getItem('language') || 'he';
      const languageToggle = document.getElementById('language-toggle'); // ×œ× ×§×™×™× ×‘×›×•×ª×¨×ª, ×‘×“×™×§×” ×œ×™×ª×¨ ×‘×˜×—×•×Ÿ
      const languageToggleMenu = document.getElementById('language-toggle-menu');
      const themeToggle = document.getElementById('theme-toggle'); // ×œ× ×§×™×™× ×‘×›×•×ª×¨×ª
      const themeToggleMenu = document.getElementById('theme-toggle-menu');
      const theme = localStorage.getItem('theme') || 'light';

      if (currentLanguage === 'en') {
        if (languageToggle) languageToggle.textContent = 'ğŸŒ ×¢×‘×¨×™×ª';
        if (languageToggleMenu) languageToggleMenu.textContent = 'ğŸŒ ×¢×‘×¨×™×ª';

        // ×˜×§×¡×˜×™× ×‘×× ×’×œ×™×ª
        document.getElementById('page-title').textContent = 'LOGIN';
        document.getElementById('username-label').textContent = 'Username';
        document.getElementById('password-label').textContent = 'Password';
        document.getElementById('remember-label').textContent = 'Remember me';
        document.getElementById('login-button').textContent = 'LOGIN';
        document.getElementById('home-link').textContent = 'Home';     // âœ… ×—×“×©
        document.getElementById('store-link').textContent = 'Store';
        document.getElementById('register-link').textContent = 'Register';
        document.getElementById('nav-store').textContent = 'Store';
        document.getElementById('nav-register').textContent = 'Register';
        document.getElementById('menuBtn').textContent = 'Menu';

        // ×”×©××¨×ª ×›×™×•×•×Ÿ RTL ×‘×× ×’×œ×™×ª
        document.documentElement.dir = 'rtl';
        document.documentElement.lang = 'en';
      } else {
        if (languageToggle) languageToggle.textContent = 'ğŸŒ English';
        if (languageToggleMenu) languageToggleMenu.textContent = 'ğŸŒ English';

        // ×˜×§×¡×˜×™× ×‘×¢×‘×¨×™×ª
        document.getElementById('page-title').textContent = '×”×ª×—×‘×¨×•×ª';
        document.getElementById('username-label').textContent = '×©× ××©×ª××©';
        document.getElementById('password-label').textContent = '×¡×™×¡××”';
        document.getElementById('remember-label').textContent = '×–×›×•×¨ ××•×ª×™';
        document.getElementById('login-button').textContent = '×”×ª×—×‘×¨×•×ª';
        document.getElementById('home-link').textContent = '×‘×™×ª';      // âœ… ×—×“×©
        document.getElementById('store-link').textContent = '×—× ×•×ª';
        document.getElementById('register-link').textContent = '×”×¨×©××”';
        document.getElementById('nav-store').textContent = '×—× ×•×ª';
        document.getElementById('nav-register').textContent = '×”×¨×©××”';
        document.getElementById('menuBtn').textContent = '×ª×¤×¨×™×˜';

        document.documentElement.dir = 'rtl';
        document.documentElement.lang = 'he';
      }

      // âœ… ×¢×“×›×•×Ÿ ×˜×§×¡×˜ ×›×¤×ª×•×¨×™ ×”×ª××•×¨×” ×‘×”×ª×× ×œ×©×¤×” ×•×”××¦×‘
      if (themeToggle) themeToggle.textContent = themeLabel(theme, currentLanguage);
      if (themeToggleMenu) themeToggleMenu.textContent = themeLabel(theme, currentLanguage);
    }

    // Theme toggle
    function toggleTheme() {
      const isDark = document.body.classList.contains('dark-theme');
      const newTheme = isDark ? 'light' : 'dark';
      localStorage.setItem('theme', newTheme);
      loadUICustomization();
    }
    const themeToggleHeader = document.getElementById('theme-toggle'); // ×œ× ×§×™×™× ×‘×›×•×ª×¨×ª (×‘×“×™×§×” ×œ×™×ª×¨ ×‘×˜×—×•×Ÿ)
    if (themeToggleHeader) themeToggleHeader.addEventListener('click', toggleTheme);
    document.getElementById('theme-toggle-menu').addEventListener('click', toggleTheme);

    // Language toggle
    function toggleLanguage() {
      const currentLanguage = localStorage.getItem('language') || 'he';
      const newLanguage = currentLanguage === 'he' ? 'en' : 'he';
      localStorage.setItem('language', newLanguage);
      loadUICustomization();
    }
    const languageToggleHeader = document.getElementById('language-toggle'); // ×œ× ×§×™×™× ×‘×›×•×ª×¨×ª (×‘×“×™×§×” ×œ×™×ª×¨ ×‘×˜×—×•×Ÿ)
    if (languageToggleHeader) languageToggleHeader.addEventListener('click', toggleLanguage);
    document.getElementById('language-toggle-menu').addEventListener('click', toggleLanguage);

    // × ×™×§×•×™ ×©×“×•×ª ×”×ª×—×‘×¨×•×ª
    window.addEventListener('load', () => {
      setTimeout(() => {
        const form = document.getElementById('login-form');
        form.username.value = '';
        form.password.value = '';
        form.rememberMe.checked = false;
        form.reset();
        form.username.setAttribute('value', '');
        form.password.setAttribute('value', '');
      }, 100);
    });
    document.getElementById('login-form').addEventListener('focusin', (e) => {
      if (e.target.tagName === 'INPUT') e.target.setAttribute('autocomplete', 'off');
    });

    // ×©×œ×™×—×ª ×˜×•×¤×¡
    document.getElementById('login-form').addEventListener('submit', async e => {
      e.preventDefault();
      const form = e.target;
      const data = {
        username: form.username.value.trim(),
        password: form.password.value,
        rememberMe: form.rememberMe.checked
      };
      const res = await fetch('/api/login', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(data)
      });
      let j = {}; try { j = await res.json(); } catch {}
      if (res.ok) location.href = '/screens/store.html';
      else alert(j.error || 'Login failed');
    });

    // ×˜×¢×™× ×” ×¨××©×•× ×™×ª
    setTimeout(() => { loadUICustomization(); }, 100);
  </script>
</body>
</html>
